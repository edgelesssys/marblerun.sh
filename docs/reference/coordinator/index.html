<!doctype html><html><head><title>Coordinator API</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://marblerun.sh/docs/reference/coordinator/><link rel=stylesheet href=https://marblerun.sh/scss/bootstrap.min.462c371c7334fb8be9e57eb1edffd6d85726378c54b9e9c7135419c4a0a7f0b9.css emotion=ðŸ¤©><script defer src=https://use.fontawesome.com/releases/v5.10.2/js/all.js></script><script async defer src=https://buttons.github.io/buttons.js></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><meta property="og:title" content="Marblerun - The control plane for confidential computing"><meta property="og:description" content="Marblerun makes it easy to deploy, scale, and verify your SGX-based apps on vanilla Kubernetes. Think Istio/Consul/Linkerd for confidential computing.â€‹"><meta property="og:image" content="https://www.marblerun.sh/img/social.png"><meta name=twitter:title content="Marblerun - The control plane for confidential computing"><meta name=twitter:description content="Marblerun makes it easy to deploy, scale, and verify your SGX-based apps on vanilla Kubernetes."><meta name=twitter:image content="https://www.marblerun.sh/img/social.png"><meta name=twitter:card content="Marblerun"></head><body><nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top container-fluid"><a class=navbar-brand href=/><img src=/img/logo.png width=140px></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/docs/introduction/><i class="fas fa-book"></i>&nbsp;Docs</a></li><li class=nav-item><a class=nav-link href=/community><i class="fas fa-comments"></i>&nbsp;Community</a></li><li class=nav-item><a class=nav-link href=https://github.com/edgelesssys/marblerun><i class="fab fa-github"></i>&nbsp;GitHub</a></li><li class=nav-item><a href=/docs/getting-started/quickstart class="nav-link btn btn-primary ml-3">Get started â†’</a></li></ul></div></nav><div class="container my-3"><div class=row><div class="col-12 col-lg-3"><div class=docsSidebar><h1 class=my-3>Docs</h1><div class=mb-3><a href=/docs/introduction/ class=d-block><h6>Introduction</h6></a></div><div class=mb-3><h6 class=cursor-pointer data-toggle=collapse data-target=#collapse1>Getting Started</h6><div class=collapse id=collapse1><a href=/docs/getting-started/quickstart/ class=d-block>Quickstart</a>
<a href=/docs/getting-started/concepts/ class=d-block>Concepts</a>
<a href=/docs/getting-started/coordinator/ class=d-block>Coordinator</a>
<a href=/docs/getting-started/marbles/ class=d-block>Marbles</a></div></div><div class=mb-3><h6 class=cursor-pointer data-toggle=collapse data-target=#collapse2>Features</h6><div class=collapse id=collapse2><a href=/docs/features/attestation/ class=d-block>Attestation</a>
<a href=/docs/features/secrets-management/ class=d-block>Secrets management</a>
<a href=/docs/features/recovery/ class=d-block>Recovery</a>
<a href=/docs/features/transparent-tls/ class=d-block>Transparent TLS</a>
<a href=/docs/features/auto-injection/ class=d-block>Kubernetes integration</a>
<a href=/docs/features/runtimes/ class=d-block>Supported runtimes</a>
<a href=/docs/features/planned-features/ class=d-block>Planned features</a></div></div><div class=mb-3><h6 class=cursor-pointer data-toggle=collapse data-target=#collapse3>Deployment</h6><div class=collapse id=collapse3><a href=/docs/deployment/cloud/ class=d-block>Cloud</a>
<a href=/docs/deployment/on-prem/ class=d-block>On-premises</a>
<a href=/docs/deployment/kubernetes/ class=d-block>Kubernetes</a>
<a href=/docs/deployment/standalone/ class=d-block>Standalone</a></div></div><div class=mb-3><h6 class=cursor-pointer data-toggle=collapse data-target=#collapse4>Workflows</h6><div class=collapse id=collapse4><a href=/docs/workflows/define-manifest/ class=d-block>Defining a manifest</a>
<a href=/docs/workflows/set-manifest/ class=d-block>Setting a manifest</a>
<a href=/docs/workflows/add-service/ class=d-block>Adding a service</a>
<a href=/docs/workflows/verification/ class=d-block>Verifying a deployment</a>
<a href=/docs/workflows/monitoring/ class=d-block>Monitoring and logging</a>
<a href=/docs/workflows/update-manifest/ class=d-block>Updating a manifest</a>
<a href=/docs/workflows/managing-secrets/ class=d-block>Managing secrets</a>
<a href=/docs/workflows/updates/ class=d-block>Updating a deployment</a>
<a href=/docs/workflows/recover-coordinator/ class=d-block>Recovering the Coordinator</a></div></div><div class=mb-3><h6 class=cursor-pointer data-toggle=collapse data-target=#collapse5>Building services</h6><div class=collapse id=collapse5><a href=/docs/building-services/ego/ class=d-block>EGo</a>
<a href=/docs/building-services/graphene/ class=d-block>Graphene</a>
<a href=/docs/building-services/occlum/ class=d-block>Occlum</a></div></div><div class=mb-3><a href=/docs/examples/ class=d-block><h6>Examples</h6></a></div><div class=mb-3><h6 class=cursor-pointer data-toggle=collapse data-target=#collapse7>Reference</h6><div class="collapse show" id=collapse7><a href=/docs/reference/coordinator/ class="d-block text-primary">> Coordinator API</a>
<a href=/docs/reference/cli/ class=d-block>CLI</a></div></div><div class=mb-3><a href=https://github.com/edgelesssys/marblerun/releases class=d-block>Changelog <i class="fas fa-external-link-square-alt"></i></a></div></div></div><div class="col-12 col-lg-9"><article><h1 id=coordinator-client-api>Coordinator client API</h1><div class=toc><nav id=TableOfContents><ul><li><a href=#jsend-response-style>JSend response style</a></li><li><a href=#endpoints>Endpoints</a><ul><li><a href=#manifest>/manifest</a></li><li><a href=#quote>/quote</a></li><li><a href=#recover>/recover</a></li><li><a href=#secrets>/secrets</a></li><li><a href=#status>/status</a></li><li><a href=#update>/update</a></li></ul></li></ul></nav></div><h2 id=jsend-response-style>JSend response style</h2><p>The Client API is designed as an HTTP-REST interface. Responses follow the <a href=https://github.com/omniti-labs/jsend>JSend</a> style, though only the response types <code>success</code> and <code>error</code> are returned so far.</p><p>In general, a successful API call (HTTP Code 200) will return a response in the following style:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#309;font-weight:700>&#34;status&#34;</span>: <span style=color:#c30>&#34;success&#34;</span>,
    <span style=color:#309;font-weight:700>&#34;data&#34;</span>: {
        <span style=color:#309;font-weight:700>&#34;ManifestSignature&#34;</span>: <span style=color:#c30>&#34;3fff78e99dd9bd801e0a3a22b7f7a24a492302c4d00546d18c7f7ed6e26e95c3&#34;</span>
    }
}
</code></pre></div><p>Depending on the API endpoint and the data submitted, <code>data</code> might contain a specific answer from the Coordinator, or may just be <code>null</code> to acknowledge that the requested operation was performed successfully.</p><p>Whereas an error (HTTP Code 4xx or 5xx) might look like this:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#309;font-weight:700>&#34;status&#34;</span>: <span style=color:#c30>&#34;error&#34;</span>,
    <span style=color:#309;font-weight:700>&#34;data&#34;</span>: <span style=color:#069;font-weight:700>null</span>,
    <span style=color:#309;font-weight:700>&#34;message&#34;</span>: <span style=color:#c30>&#34;server is not in expected state&#34;</span>
}
</code></pre></div><p>For errors, <code>data</code> will always be <code>null</code>, and <code>message</code> contains the specific error the Coordinator ran into when processing the request.</p><h2 id=endpoints>Endpoints</h2><p>The API currently contains the following endpoints. If an endpoint specifies <em>Returns</em> for either HTTP GET or HTTP POST, it means that the specified data can be found encoded inside the <code>data</code> block if the response was successful. If no returns are specified for a given endpoint, or in case all possible return values for an endpoint are declared as optional, <code>data</code> can just be <code>null</code>.</p><h3 id=manifest>/manifest</h3><p>For deploying and verifying the manifest.</p><ul><li>Before deploying the application to the cluster the manifest needs to be set once by the provider</li><li>Users can retrieve and inspect the manifest through this endpoint before interacting with the application</li></ul><h5 id=get>GET</h5><p><strong>Returns</strong>:<table class="table table-striped table-bordered"><thead><tr><th>Field value</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>ManifestSignature</td><td>string</td><td>A SHA-256 of the currently set manifest. Does not change when an update has been applied.</td></tr><tr><td>Manifest</td><td>bytes</td><td>The currently set manifest in base64 encoding. Does not change when an update has been applied.</td></tr></tbody></table></p><h5 id=post>POST</h5><p><strong>Returns</strong>:<table class="table table-striped table-bordered"><thead><tr><th>Field value</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>RecoverySecrets</td><td>array (optional)</td><td>An array containing key-value mapping for encrypted secrets to be used for recovering the Coordinator in case of disaster recovery. The key matches each supplied key from <code>RecoveryKeys</code> in the manifest.</td></tr></tbody></table></p><p>Example for setting the manifest (HTTP POST):</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl --cacert marblerun.crt --data-binary @manifest.json <span style=color:#c30>&#34;https://</span><span style=color:#033>$MARBLERUN</span><span style=color:#c30>/manifest&#34;</span>
</code></pre></div><p>Example for verifying the deployed manifest (HTTP GET):</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl --cacert marblerun.crt <span style=color:#c30>&#34;https://</span><span style=color:#033>$MARBLERUN</span><span style=color:#c30>/manifest&#34;</span> | jq <span style=color:#c30>&#39;.data.ManifestSignature&#39;</span> --raw-output
</code></pre></div><h3 id=quote>/quote</h3><p>For retrieving a remote attestation quote over the whole cluster and the root certificate.
The quote is an SGX-DCAP quote, you can learn more about DCAP in the <a href=https://download.01.org/intel-sgx/sgx-dcap/1.9/linux/docs/Intel_SGX_DCAP_ECDSA_Orientation.pdf>official Intel DCAP orientation</a>.
Both the provider and the users of the confidential application can use this endpoint to verify the integrity of the Coordinator and the cluster at any time.</p><h5 id=get-1>GET</h5><p><strong>Returns</strong>:<table class="table table-striped table-bordered"><thead><tr><th>Field value</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>Cert</td><td>string</td><td>A PEM-encoded certificate chain containing the Coordinator&rsquo;s Root CA and Intermediate CA, which can be used for trust establishment between a client and the Coordinator.</td></tr><tr><td>Quote</td><td>string</td><td>Base64-encoded quote which can be used for Remote Attestation, as described in <a href=https://marblerun.sh/docs/workflows/verification/>Verifying a deployment</a></td></tr></tbody></table></p><p>Example for retrieving a quote</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl -k <span style=color:#c30>&#34;https://</span><span style=color:#033>$MARBLERUN</span><span style=color:#c30>/quote&#34;</span>
</code></pre></div><p>We provide a tool to automatically verify the quote and output the trusted certificate:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#09f;font-style:italic># Either install era for the current user</span>
wget -P ~/.local/bin https://github.com/edgelesssys/era/releases/latest/download/era
chmod +x ~/.local/bin/era

<span style=color:#09f;font-style:italic># Or install it globally on your machine (requires root permissions)</span>
sudo wget -O /usr/local/bin/era https://github.com/edgelesssys/era/releases/latest/download/era
sudo chmod +x /usr/local/bin/era

era -c coordinator-era.json -h <span style=color:#033>$MARBLERUN</span> -o marblerun.crt
</code></pre></div><div class=note><p><i class="fa fa-info-circle"></i>&nbsp;<strong>Note</strong></p>On Ubuntu, <code>~/.local/bin</code> is only added to PATH when the directory exists when initializing your bash environment during login. You might need to re-login after creating the directory. Also, non-default shells such as <code>zsh</code> do not add this path by default. Therefore, if you receive <code>command not found: era</code> as an error message for a local user installation, either make sure <code>~/.local/bin</code> was added to your PATH successfully or simply use the machine-wide installation method.</div><p>The file <code>coordinator-era.json</code> contains the <em>Packages</em> information for the Coordinator. For our testing image this can be pulled from our GitHub releases:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>wget https://github.com/edgelesssys/marblerun/releases/latest/download/coordinator-era.json
</code></pre></div><h3 id=recover>/recover</h3><p>For recovering the Coordinator in case unsealing the existing state failed.</p><h5 id=post-1>POST</h5><p>This API endpoint is only available when the Coordinator is in recovery mode. Before you can use the endpoint, you need to decrypt the recovery secret which you may have received when setting the manifest initially. See <a href=https://marblerun.sh/docs/workflows/recover-coordinator/>Recovering the Coordinator</a> to retrieve the recovery key needed to use this API endpoint correctly.</p><p>Example for recovering the Coordinator:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl -k -X POST --data-binary @recovery_key_decrypted <span style=color:#c30>&#34;https://</span><span style=color:#033>$MARBLERUN</span><span style=color:#c30>/recover&#34;</span>
</code></pre></div><h3 id=secrets>/secrets</h3><p>For setting and retrieving secrets.</p><p>This API endpoint only works when <code>Users</code> were defined in the manifest. For more information, look up <a href=https://marblerun.sh/docs/workflows/managing-secrets/>Managing secrets</a>.</p><h5 id=get-2>GET</h5><p><strong>Returns</strong>:<table class="table table-striped table-bordered"><thead><tr><th>Field value</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>&lt;SecretName> (one or more)</td><td>map</td><td>A map containing key-value pairs for the requested secret.</td></tr></tbody></table></p><p>Each GET requests allows specifying one or more secrets in the form of a query string, where each parameter <code>s</code> specifies one secret.
A query string for the secrets <code>symmetric_key_shared</code> and <code>cert_shared</code> may look like the following:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>s=symmetric_key_shared&amp;s=cert_shared
</code></pre></div><p>Example for retrieving the secrets <code>symmetric_key_shared</code> and <code>cert_shared</code>:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl --cacert marblerun.crt --cert user_certificate.crt --key user_private.key https://<span style=color:#033>$MARBLERUN</span>/secrets?s<span style=color:#555>=</span>symmetric_key_shared&amp;<span style=color:#033>s</span><span style=color:#555>=</span>cert_shared
</code></pre></div><h5 id=post-2>POST</h5><p>Setting secrets requires uploading them in JSON format using a POST request. For more information refer to <a href=https://marblerun.sh/docs/workflows/managing-secrets/>Managing secrets</a>.</p><p>Example for setting secrets from the file <code>secrets.json</code>:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl --cacert marblerun.crt --cert user_certificate.crt --key user_private.key --data-binary @secrets.json https://<span style=color:#033>$MARBLERUN</span>/secrets
</code></pre></div><h3 id=status>/status</h3><p>For returning the current state of the Coordinator.</p><h5 id=get-3>GET</h5><p><strong>Returns</strong>:<table class="table table-striped table-bordered"><thead><tr><th>Field value</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>StatusCode</td><td>int</td><td>A status code that matches the internal code of the Coordinator&rsquo;s current state.</td></tr><tr><td>StatusMessage</td><td>string</td><td>A descriptive status message of what the Coordinator expects the user to do in its current state.</td></tr></tbody></table></p><p><strong>Possible values</strong>:</p><table class="table table-striped table-bordered"><thead><tr><th>StatusCode</th><th>StatusMessage</th></tr></thead><tbody><tr><td>1</td><td>Coordinator is in recovery mode. Either upload a key to unseal the saved state, or set a new manifest. For more information on how to proceed, consult the documentation.</td></tr><tr><td>2</td><td>Coordinator is ready to accept a manifest.</td></tr><tr><td>3</td><td>Coordinator is running correctly and ready to accept marbles.</td></tr></tbody></table><p>Example for getting the status:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl -k <span style=color:#c30>&#34;https://</span><span style=color:#033>$MARBLERUN</span><span style=color:#c30>/status&#34;</span>
</code></pre></div><p>It may be useful to use this API endpoint and use it for other monitoring tools. More information can be found under <a href=https://marblerun.sh/docs/workflows/monitoring/>Monitoring and Logging</a></p><h3 id=update>/update</h3><p>For updating the packages specified in the currently set manifest or retrieving a log of all performed updates.</p><h5 id=get-4>GET</h5><p><strong>Returns:</strong></p><p>A structured log of all updates performed via the <code>/update</code> or <code>/secrets</code> endpoint, including timestamp, author, and affected resources.</p><p>Example for getting the update log:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl -k <span style=color:#c30>&#34;https://</span><span style=color:#033>$MARBLERUN</span><span style=color:#c30>/update&#34;</span>
</code></pre></div><h5 id=post-3>POST</h5><p>This API endpoint only works when <code>Users</code> were defined in the manifest. For more information, look up <a href=https://marblerun.sh/docs/workflows/update-manifest/>&ldquo;updating a manifest&rdquo;</a></p><p>Example for updating the manifest:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl --cacert marblerun.crt --cert user_certificate.crt --key user_private.key -w <span style=color:#c30>&#34;%{http_code}&#34;</span> --data-binary @update_manifest.json https://<span style=color:#033>$MARBLERUN</span>/update
</code></pre></div></article></div></div></div><footer class="bg-light text-center p-3"><div>Marblerun is brought to you by <a target=_blank href=https://edgeless.systems/>Edgeless Systems GmbH <img src=/img/ES_Symbol_black.svg class="verticle-align-middle ml-2" alt="Edgeless Systems GmbH Logo" width=14px class=mb-3></a></div></footer><script src=https://code.jquery.com/jquery-3.5.1.slim.min.js integrity=sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js integrity=sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx crossorigin=anonymous></script><script src=/js/main.js></script></body></html>