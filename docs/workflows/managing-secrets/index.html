<!doctype html><html><head><title>Managing secrets</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://marblerun.sh/docs/workflows/managing-secrets/><link rel=stylesheet href=https://marblerun.sh/scss/bootstrap.min.462c371c7334fb8be9e57eb1edffd6d85726378c54b9e9c7135419c4a0a7f0b9.css emotion=ðŸ¤©><script defer src=https://use.fontawesome.com/releases/v5.10.2/js/all.js></script><script async defer src=https://buttons.github.io/buttons.js></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><meta property="og:title" content="Marblerun - The control plane for confidential computing"><meta property="og:description" content="Marblerun makes it easy to deploy, scale, and verify your SGX-based apps on vanilla Kubernetes. Think Istio/Consul/Linkerd for confidential computing.â€‹"><meta property="og:image" content="https://www.marblerun.sh/img/social.png"><meta name=twitter:title content="Marblerun - The control plane for confidential computing"><meta name=twitter:description content="Marblerun makes it easy to deploy, scale, and verify your SGX-based apps on vanilla Kubernetes."><meta name=twitter:image content="https://www.marblerun.sh/img/social.png"><meta name=twitter:card content="Marblerun"></head><body><nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top container-fluid"><a class=navbar-brand href=/><img src=/img/logo.png width=140px></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/docs/introduction/><i class="fas fa-book"></i>&nbsp;Docs</a></li><li class=nav-item><a class=nav-link href=/community><i class="fas fa-comments"></i>&nbsp;Community</a></li><li class=nav-item><a class=nav-link href=https://github.com/edgelesssys/marblerun><i class="fab fa-github"></i>&nbsp;GitHub</a></li><li class=nav-item><a href=/docs/getting-started/quickstart class="nav-link btn btn-primary ml-3">Get started â†’</a></li></ul></div></nav><div class="container my-3"><div class=row><div class="col-12 col-lg-3"><div class=docsSidebar><h1 class=my-3>Docs</h1><div class=mb-3><a href=/docs/introduction/ class=d-block><h6>Introduction</h6></a></div><div class=mb-3><h6 class=cursor-pointer data-toggle=collapse data-target=#collapse1>Getting Started</h6><div class=collapse id=collapse1><a href=/docs/getting-started/quickstart/ class=d-block>Quickstart</a>
<a href=/docs/getting-started/concepts/ class=d-block>Concepts</a>
<a href=/docs/getting-started/coordinator/ class=d-block>Coordinator</a>
<a href=/docs/getting-started/marbles/ class=d-block>Marbles</a></div></div><div class=mb-3><h6 class=cursor-pointer data-toggle=collapse data-target=#collapse2>Features</h6><div class=collapse id=collapse2><a href=/docs/features/attestation/ class=d-block>Attestation</a>
<a href=/docs/features/secrets-management/ class=d-block>Secrets management</a>
<a href=/docs/features/recovery/ class=d-block>Recovery</a>
<a href=/docs/features/transparent-tls/ class=d-block>Transparent TLS</a>
<a href=/docs/features/auto-injection/ class=d-block>Kubernetes integration</a>
<a href=/docs/features/runtimes/ class=d-block>Supported runtimes</a>
<a href=/docs/features/planned-features/ class=d-block>Planned features</a></div></div><div class=mb-3><h6 class=cursor-pointer data-toggle=collapse data-target=#collapse3>Deployment</h6><div class=collapse id=collapse3><a href=/docs/deployment/cloud/ class=d-block>Cloud</a>
<a href=/docs/deployment/on-prem/ class=d-block>On-premises</a>
<a href=/docs/deployment/kubernetes/ class=d-block>Kubernetes</a>
<a href=/docs/deployment/standalone/ class=d-block>Standalone</a></div></div><div class=mb-3><h6 class=cursor-pointer data-toggle=collapse data-target=#collapse4>Workflows</h6><div class="collapse show" id=collapse4><a href=/docs/workflows/define-manifest/ class=d-block>Defining a manifest</a>
<a href=/docs/workflows/set-manifest/ class=d-block>Setting a manifest</a>
<a href=/docs/workflows/add-service/ class=d-block>Adding a service</a>
<a href=/docs/workflows/verification/ class=d-block>Verifying a deployment</a>
<a href=/docs/workflows/monitoring/ class=d-block>Monitoring and logging</a>
<a href=/docs/workflows/update-manifest/ class=d-block>Updating a manifest</a>
<a href=/docs/workflows/managing-secrets/ class="d-block text-primary">> Managing secrets</a>
<a href=/docs/workflows/updates/ class=d-block>Updating a deployment</a>
<a href=/docs/workflows/recover-coordinator/ class=d-block>Recovering the Coordinator</a></div></div><div class=mb-3><h6 class=cursor-pointer data-toggle=collapse data-target=#collapse5>Building services</h6><div class=collapse id=collapse5><a href=/docs/building-services/ego/ class=d-block>EGo</a>
<a href=/docs/building-services/graphene/ class=d-block>Graphene</a>
<a href=/docs/building-services/occlum/ class=d-block>Occlum</a></div></div><div class=mb-3><a href=/docs/examples/ class=d-block><h6>Examples</h6></a></div><div class=mb-3><h6 class=cursor-pointer data-toggle=collapse data-target=#collapse7>Reference</h6><div class=collapse id=collapse7><a href=/docs/reference/coordinator/ class=d-block>Coordinator API</a>
<a href=/docs/reference/cli/ class=d-block>CLI</a></div></div><div class=mb-3><a href=https://github.com/edgelesssys/marblerun/releases class=d-block>Changelog <i class="fas fa-external-link-square-alt"></i></a></div></div></div><div class="col-12 col-lg-9"><article><h1 id=managing-secrets>Managing secrets</h1><p>In some cases users might need to access secrets generated by the Coordinator or pass in secrets to Marblerun themselves.</p><p>For example, an application might require an access token, to establish a secure connections to an external service.
While setting the token directly in the manifest is an option, this would mean exposing the potentially confidential token to everyone with access to the manifest.</p><p>For such cases, Marblerun allows predefined users to upload secrets that have been predefined in the manifest.
Similarly, predefined users can retrieve particular secrets from the Coordinatorvia the <code>/secrets</code> endpoint.</p><h2 id=reading-a-secret>Reading a secret</h2><p>Authorized users can use the client API to read secrets in JSON format.</p><p>For example, the following command to requests a secret named <code>symmetric_key_shared</code>:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>marblerun secret get symmetric_key_shared <span style=color:#033>$MARBLERUN</span> --cert<span style=color:#555>=</span>admin-cert.pem --key<span style=color:#555>=</span>admin-key.pem --era-config<span style=color:#555>=</span>era.json
</code></pre></div><p>If the user has the require permissions, the secret is returned:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>symmetric_key_shared:
	Type:          symmetric-key
	UserDefined:   false
	Size:          128
	Key:           uVGpoJZTRICLccJiVNt9jA==
</code></pre></div><h2 id=setting-a-secret>Setting a secret</h2><p>A user can upload secrets via the REST-API in JSON format. The secrets need to be marked as <code>UserDefined</code>.</p><p>For secrets of the types <code>cert-rsa</code>, <code>cert-ecdsa</code> and <code>cert-ed25519</code> the CLI supports directly uploading a PEM encoded certificate and key.
Take for example this file containing a certificate and corresponding private key:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>-----BEGIN CERTIFICATE-----
MIICpjC ... zrNxzg==
-----END CERTIFICATE-----

-----BEGIN PRIVATE KEY-----
MIICeAI ... 8bu8Z+Fe
-----END PRIVATE KEY-----
</code></pre></div><p>The following command sets this certificate as a secret named <code>user-certificate</code>:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>marblerun secret <span style=color:#366>set</span> secret_file.pem <span style=color:#033>$MARBLERUN</span> --from-pem user-secret --cert<span style=color:#555>=</span>admin-cert.pem --key<span style=color:#555>=</span>admin-key.pem --era-config<span style=color:#555>=</span>era.json
</code></pre></div><p>To upload different types, or a batch of secrets, a file with the secrets in JSON format is needed.
Each entry in the file is a JSON object labeled by the name of the secret and contains values depending on its type:</p><ul><li>For the types <code>cert-rsa</code>, <code>cert-ecdsa</code> and <code>cert-ed25519</code>:<ul><li><code>Cert</code>: A PEM encoded certificate.
To preserve newlines correctly set <code>Cert</code> to the output of the following command:<div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#366>echo</span> -n <span style=color:#069;font-weight:700>$(</span>cat &lt;secret_certificate&gt;.pem | sed <span style=color:#c30>&#39;1,1d;$ d&#39;</span> | awk <span style=color:#c30>&#39;NF {sub(/\r/, &#34;&#34;); printf &#34;%s\\n&#34;,$0;}&#39;</span><span style=color:#069;font-weight:700>)</span>
</code></pre></div></li><li><code>Private</code>: A PEM encoded private key. This may be omitted.
To preserve newlines correctly set <code>Private</code> to the output of the following command:<div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#366>echo</span> -n <span style=color:#069;font-weight:700>$(</span>cat &lt;secret_private_key&gt;.pem | sed <span style=color:#c30>&#39;1,1d;$ d&#39;</span> | awk <span style=color:#c30>&#39;NF {sub(/\r/, &#34;&#34;); printf &#34;%s\\n&#34;,$0;}&#39;</span><span style=color:#069;font-weight:700>)</span>
</code></pre></div></li></ul></li><li>For type <code>symmetric-key</code>:<ul><li>Key: a base64 encoded key, with length matching the size defined in the original manifest</li></ul></li><li>For the type <code>plain</code>:<ul><li><code>Key</code>: arbitrary data in base64 encoding. This may be a key of unspecified length, a confidential config file, or any kind of data only some Marbles and/or users should have access to.</li></ul></li></ul><p>The following gives an example for a file to set the secrets <code>user_defined_symmetric_key</code>, <code>user_defined_cert</code>, and <code>generic_secret</code>:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript>{
  <span style=color:#c30>&#34;user_defined_symmetric_key&#34;</span><span style=color:#555>:</span> {
    <span style=color:#c30>&#34;Key&#34;</span><span style=color:#555>:</span> <span style=color:#c30>&#34;AAECAwQFBgcICQoLDA0ODw==&#34;</span>
  },
  <span style=color:#c30>&#34;user_defined_cert&#34;</span><span style=color:#555>:</span> {
    <span style=color:#c30>&#34;Cert&#34;</span><span style=color:#555>:</span> <span style=color:#c30>&#34;MIIBjDCCATOgAwIBAgICBTkwCgYIKoZIzj0EAwIwMjEwMC4GA1UEAxMnTWFyYmxlcnVuIENvb3JkaW5hdG9yIC0gSW50ZXJtZWRpYXRlIENBMB4XDTIxMDYxNTA4NTY0M1oXDTIxMDYyMjA4NTY0M1owLTEcMBoGA1UEAxMTTWFyYmxlcnVuIFVuaXQgVGVzdDENMAsGA1UEBRMEMTMzNzAqMAUGAytlcAMhAEPOc066G5XmvLizOKTENSR+U9lv3geZ0/a2+XkhJRvDo20wazAOBgNVHQ8BAf8EBAMCAoQwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwLAYDVR0RBCUwI4IJbG9jYWxob3N0hwR/AAABhxAAAAAAAAAAAAAAAAAAAAABMAoGCCqGSM49BAMCA0cAMEQCIGOlRcynaPaj/flSr2ZEvmTmhuvtmTb4QkwPFtxFz3EJAiB77ijxAcJNxPKcKmgMB+c8NORC+6N/St2iP/oX/vqQvg==&#34;</span>,
    <span style=color:#c30>&#34;Private&#34;</span><span style=color:#555>:</span> <span style=color:#c30>&#34;MC4CAQAwBQYDK2VwBCIEIPlmAOOhAStk8ytxzvekPr8zLaQa9+lxnHK+CizDrMds&#34;</span>
  },
  <span style=color:#c30>&#34;generic_secret&#34;</span><span style=color:#555>:</span> {
    <span style=color:#c30>&#34;Key&#34;</span><span style=color:#555>:</span> <span style=color:#c30>&#34;SGVsbG8gZnJvbSB0aGUgTWFyYmxlcnVuIERvY3MhCg==&#34;</span>
  }
}
</code></pre></div><p>This file can then be uploaded using the CLI and the users credentials:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>marblerun secret <span style=color:#366>set</span> secret_file.json <span style=color:#033>$MARBLERUN</span> --cert<span style=color:#555>=</span>admin-cert.pem --key<span style=color:#555>=</span>admin-key.pem --era-config<span style=color:#555>=</span>era.json
</code></pre></div><p>Subsequently, the secrets can be accessed by marbles and authorized users. If the user lacks permission to set one of the secrets, or a secret the user tried to upload was malformed an error occurs instead.</p></article></div></div></div><footer class="bg-light text-center p-3"><div>Marblerun is brought to you by <a target=_blank href=https://edgeless.systems/>Edgeless Systems GmbH <img src=/img/ES_Symbol_black.svg class="verticle-align-middle ml-2" alt="Edgeless Systems GmbH Logo" width=14px class=mb-3></a></div></footer><script src=https://code.jquery.com/jquery-3.5.1.slim.min.js integrity=sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js integrity=sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx crossorigin=anonymous></script><script src=/js/main.js></script></body></html>