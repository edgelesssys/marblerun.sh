<!doctype html><html><head><title>Updating a Manifest</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://marblerun.sh/docs/additional-workflows/update-manifest/><link rel=stylesheet href=https://marblerun.sh/scss/bootstrap.min.b34363dc2fd8ff214ebdc9fc5affef728cbcf6271a9be12263a2904a48f10509.css emotion=ðŸ¤©><script defer src=https://use.fontawesome.com/releases/v5.10.2/js/all.js></script><script async defer src=https://buttons.github.io/buttons.js></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><meta property="og:title" content="Marblerun - The control plane for confidential computing"><meta property="og:description" content="Marblerun makes it easy to deploy, scale, and verify your SGX-based apps on vanilla Kubernetes. Think Istio/Consul/Linkerd for confidential computing.â€‹"><meta property="og:image" content="https://www.marblerun.sh/img/social.png"><meta name=twitter:title content="Marblerun - The control plane for confidential computing"><meta name=twitter:description content="Marblerun makes it easy to deploy, scale, and verify your SGX-based apps on vanilla Kubernetes."><meta name=twitter:image content="https://www.marblerun.sh/img/social.png"><meta name=twitter:card content="Marblerun"></head><body><nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top container-fluid"><a class=navbar-brand href=/><img src=/img/logo.png width=140px></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/docs/introduction/><i class="fas fa-book"></i>&nbsp;Docs</a></li><li class=nav-item><a class=nav-link href=/community><i class="fas fa-comments"></i>&nbsp;Community</a></li><li class=nav-item><a class=nav-link href=https://github.com/edgelesssys/marblerun><i class="fab fa-github"></i>&nbsp;GitHub</a></li><li class=nav-item><a href=/docs/getting-started/quickstart class="nav-link btn btn-primary ml-3">Get started â†’</a></li></ul></div></nav><div class="container my-3"><h1 class=my-3>Docs</h1><div class=row><div class="col-12 col-lg-3"><div class=docsSidebar><div class=mb-3><a href=/docs/introduction/ class=d-block>Introduction</a></div><div class=mb-3><h6>Getting Started</h6><a href=/docs/getting-started/quickstart/ class=d-block>Quickstart</a>
<a href=/docs/getting-started/concepts/ class=d-block>Concepts</a>
<a href=/docs/getting-started/coordinator/ class=d-block>Coordinator</a>
<a href=/docs/getting-started/marbles/ class=d-block>Marbles</a>
<a href=/docs/getting-started/cli/ class=d-block>CLI</a></div><div class=mb-3><h6>Features</h6><a href=/docs/features/attestation/ class=d-block>Attestation</a>
<a href=/docs/features/recovery/ class=d-block>Recovery</a>
<a href=/docs/features/secrets-management/ class=d-block>Secrets management</a>
<a href=/docs/features/auto-injection/ class=d-block>Kubernetes integration</a>
<a href=/docs/features/runtimes/ class=d-block>Supported runtimes</a>
<a href=/docs/features/planned-features/ class=d-block>Planned features</a></div><div class=mb-3><h6>Deployment</h6><a href=/docs/deployment/cloud/ class=d-block>Cloud</a>
<a href=/docs/deployment/on-prem/ class=d-block>On-premises</a>
<a href=/docs/deployment/kubernetes/ class=d-block>Kubernetes</a>
<a href=/docs/deployment/standalone/ class=d-block>Standalone</a></div><div class=mb-3><h6>Core workflows</h6><a href=/docs/workflows/define-manifest/ class=d-block>Defining a Manifest</a>
<a href=/docs/workflows/set-manifest/ class=d-block>Setting a Manifest</a>
<a href=/docs/workflows/add-service/ class=d-block>Adding a service</a>
<a href=/docs/workflows/verification/ class=d-block>Verifying a deployment</a></div><div class=mb-3><h6>Additional workflows</h6><a href=/docs/additional-workflows/monitoring/ class=d-block>Monitoring and logging</a>
<a href=/docs/additional-workflows/update-manifest/ class="d-block text-primary">> Updating a Manifest</a>
<a href=/docs/additional-workflows/updates/ class=d-block>Updating a deployment</a>
<a href=/docs/additional-workflows/recover-coordinator/ class=d-block>Recovering the Coordinator</a></div><div class=mb-3><h6>Building services</h6><a href=/docs/building-services/ego/ class=d-block>EGo</a>
<a href=/docs/building-services/graphene/ class=d-block>Graphene</a>
<a href=/docs/building-services/occlum/ class=d-block>Occlum</a></div><div class=mb-3><h6>Examples</h6><a href=/docs/examples/helloworld/ class=d-block>Hello world</a>
<a href=/docs/examples/emojivoto/ class=d-block>Emoji voting</a>
<a href=/docs/examples/graphene/ class=d-block>Graphene-based examples</a>
<a href=/docs/examples/occlum/ class=d-block>Occlum-based example</a></div><div class=mb-3><a href=/docs/changelog/ class=d-block>Changelog</a></div></div></div><div class="col-12 col-lg-9"><article><h1 id=updating-a-manifest>Updating a Manifest</h1><p>In order to ensure the confidentiality of a deployed application, Marblerun uses a Manifest to which defines the software packages and the infrastructure your deployment uses. To verify that your deployment has not been altered with, the Manifest is usually set in stone after it was set to ensure no one can alter with your cluster.</p><p>Yet, updates play an important role to ensure your software stays secure. To avoid having to redeploy your application from scratch, Marblerun allows to upload a separate &ldquo;Update Manifest&rdquo; which increases the minimum <code>SecurityVersion</code> of one or multiple already deployed package. After such an update is performed, an old version of a defined software package cannot be loaded anymore under the current Manifest.</p><h2 id=requirements>Requirements</h2><p>In order to deploy an Update Manifest, the original Manifest, you need to be in possession of a certificate/private key pair which has been defined in the <code>Admins</code> section of the original Manifest, as described in <a href=https://marblerun.sh/docs/workflows/define-manifest/#manifestmarbles>&ldquo;Defining a Manifest&rdquo;</a>.</p><p>If no administrator has been initially set up, no Manifest Updates can be applied.</p><h2 id=defining-an-update-manifest>Defining an Update Manifest</h2><p>The format of an Update Manifest follows the syntax of the original Manifest, though it only expects to contain a package name and a new <code>SecurityVersion</code> value set for it.</p><p>For example, the current <code>Packages</code> section of your original Manifest looks like this:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript>{
    <span style=color:#09f;font-style:italic>// ...
</span><span style=color:#09f;font-style:italic></span>    <span style=color:#c30>&#34;Packages&#34;</span><span style=color:#555>:</span> {
        <span style=color:#c30>&#34;pkg0&#34;</span><span style=color:#555>:</span> {
            <span style=color:#c30>&#34;UniqueID&#34;</span><span style=color:#555>:</span> <span style=color:#c30>&#34;6b2822ac2585040d4b9397675d54977a71ef292ab5b3c0a6acceca26074ae585&#34;</span>,
            <span style=color:#c30>&#34;Debug&#34;</span><span style=color:#555>:</span> <span style=color:#069;font-weight:700>false</span>
        },
        <span style=color:#c30>&#34;pkg1&#34;</span><span style=color:#555>:</span> {
            <span style=color:#c30>&#34;SignerID&#34;</span><span style=color:#555>:</span> <span style=color:#c30>&#34;43361affedeb75affee9baec7e054a5e14883213e5a121b67d74a0e12e9d2b7a&#34;</span>,
            <span style=color:#c30>&#34;ProductID&#34;</span><span style=color:#555>:</span> <span style=color:#f60>43</span>,
            <span style=color:#c30>&#34;SecurityVersion&#34;</span><span style=color:#555>:</span> <span style=color:#f60>3</span>,
            <span style=color:#c30>&#34;Debug&#34;</span><span style=color:#555>:</span> <span style=color:#069;font-weight:700>true</span>
        }
    }
    <span style=color:#09f;font-style:italic>// ...
</span><span style=color:#09f;font-style:italic></span>}
</code></pre></div><p>If you now want to update the minimum required version for <code>pkg1</code>, the complete definition for the update Manifest just needs to be as short this example:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript>{
    <span style=color:#c30>&#34;Packages&#34;</span><span style=color:#555>:</span> {
        <span style=color:#c30>&#34;pkg1&#34;</span><span style=color:#555>:</span> {
            <span style=color:#c30>&#34;SecurityVersion&#34;</span><span style=color:#555>:</span> <span style=color:#f60>5</span>
        }
    }
}
</code></pre></div><p>Please do not define other values except than <code>SecurityVersion</code> value for a package, as Marblerun will refuse to accept such an Update Manifest.</p><p>Also, if an Update Manifest was already set and you want to deploy another update on top of it too, you can! Just make sure that the new Update Manifest contains each specified package as the old one does, and that the <code>SecurityVersion</code> is indeed higher than defined in the previous Update Manifest, as downgrades are not supported for security reasons.</p><h2 id=deploying-an-update-manifest>Deploying an Update Manifest</h2><p>Similar to other operations, an Update Manifest can be deployed e.g. with the help of the CLI. Note that for this operation, you need to specify one of your defined <code>Admins</code> certificates as a TLS client certificate, combined with the according private key.</p><p>This operation can be performed in the following way:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>marblerun manifest update update-manifest.json <span style=color:#033>$MARBLERUN</span> --cert<span style=color:#555>=</span>admin-cert.pem --key<span style=color:#555>=</span>admin-key.pem --era-config<span style=color:#555>=</span>era.json
</code></pre></div><p>If everything went well, no message will be returned and your Marblerun logs should highlight that an Update Manifest has been set. And if something went wrong, the API endpoint will return an error message telling you what happened. If you receive <code>unauthorized user</code> back, it means Marblerun either received no client certificate over the TLS connection, or you used the wrong certificate.</p><h2 id=effects-of-an-update-manifest>Effects of an Update Manifest</h2><p>When a Manifest has been updated, the coordinator will generate new certificates which your Marbles will receive upon the next startup. Also, if you are trying to launch Marbles based on packages containing the old <code>SecurityVersion</code>, they will refuse to run (unless you are running in SGX Simulation or non-Enclave mode). However, so far currently running Marble will continue to run and will be able to authenticate each other as long as they are still running, so if you need to enforce an update, make sure to kill the Marbles on your host and restart them.</p></article></div></div></div><footer class="bg-light text-center p-3"><div>Marblerun is brought to you by <a target=_blank href=https://edgeless.systems/>Edgeless Systems GmbH <img src=/img/ES_Symbol_black.svg class="verticle-align-middle ml-2" alt="Edgeless Systems GmbH Logo" width=14px class=mb-3></a></div></footer><script src=https://code.jquery.com/jquery-3.5.1.slim.min.js integrity=sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js integrity=sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx crossorigin=anonymous></script><script src=/js/main.js></script></body></html>