<!doctype html><html><head><title>On-premises</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://marblerun.sh/docs/deployment/on-prem/><link rel=stylesheet href=https://marblerun.sh/scss/bootstrap.min.462c371c7334fb8be9e57eb1edffd6d85726378c54b9e9c7135419c4a0a7f0b9.css emotion=ðŸ¤©><script defer src=https://use.fontawesome.com/releases/v5.10.2/js/all.js></script><script async defer src=https://buttons.github.io/buttons.js></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><meta property="og:title" content="Marblerun - The control plane for confidential computing"><meta property="og:description" content="Marblerun makes it easy to deploy, scale, and verify your SGX-based apps on vanilla Kubernetes. Think Istio/Consul/Linkerd for confidential computing.â€‹"><meta property="og:image" content="https://www.marblerun.sh/img/social.png"><meta name=twitter:title content="Marblerun - The control plane for confidential computing"><meta name=twitter:description content="Marblerun makes it easy to deploy, scale, and verify your SGX-based apps on vanilla Kubernetes."><meta name=twitter:image content="https://www.marblerun.sh/img/social.png"><meta name=twitter:card content="Marblerun"></head><body><nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top container-fluid"><a class=navbar-brand href=/><img src=/img/logo.png width=140px></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/docs/introduction/><i class="fas fa-book"></i>&nbsp;Docs</a></li><li class=nav-item><a class=nav-link href=/community><i class="fas fa-comments"></i>&nbsp;Community</a></li><li class=nav-item><a class=nav-link href=https://github.com/edgelesssys/marblerun><i class="fab fa-github"></i>&nbsp;GitHub</a></li><li class=nav-item><a href=/docs/getting-started/quickstart class="nav-link btn btn-primary ml-3">Get started â†’</a></li></ul></div></nav><div class="container my-3"><div class=row><div class="col-12 col-lg-3"><div class=docsSidebar><h1 class=my-3>Docs</h1><div class=mb-3><a href=/docs/introduction/ class=d-block><h6>Introduction</h6></a></div><div class=mb-3><h6 class=cursor-pointer data-toggle=collapse data-target=#collapse1>Getting Started</h6><div class=collapse id=collapse1><a href=/docs/getting-started/quickstart/ class=d-block>Quickstart</a>
<a href=/docs/getting-started/concepts/ class=d-block>Concepts</a>
<a href=/docs/getting-started/coordinator/ class=d-block>Coordinator</a>
<a href=/docs/getting-started/marbles/ class=d-block>Marbles</a>
<a href=/docs/getting-started/cli/ class=d-block>CLI</a></div></div><div class=mb-3><h6 class=cursor-pointer data-toggle=collapse data-target=#collapse2>Features</h6><div class=collapse id=collapse2><a href=/docs/features/attestation/ class=d-block>Attestation</a>
<a href=/docs/features/recovery/ class=d-block>Recovery</a>
<a href=/docs/features/secrets-management/ class=d-block>Secrets management</a>
<a href=/docs/features/auto-injection/ class=d-block>Kubernetes integration</a>
<a href=/docs/features/runtimes/ class=d-block>Supported runtimes</a>
<a href=/docs/features/planned-features/ class=d-block>Planned features</a></div></div><div class=mb-3><h6 class=cursor-pointer data-toggle=collapse data-target=#collapse3>Deployment</h6><div class="collapse show" id=collapse3><a href=/docs/deployment/cloud/ class=d-block>Cloud</a>
<a href=/docs/deployment/on-prem/ class="d-block text-primary">> On-premises</a>
<a href=/docs/deployment/kubernetes/ class=d-block>Kubernetes</a>
<a href=/docs/deployment/standalone/ class=d-block>Standalone</a></div></div><div class=mb-3><h6 class=cursor-pointer data-toggle=collapse data-target=#collapse4>Core workflows</h6><div class=collapse id=collapse4><a href=/docs/workflows/define-manifest/ class=d-block>Defining a Manifest</a>
<a href=/docs/workflows/set-manifest/ class=d-block>Setting a Manifest</a>
<a href=/docs/workflows/add-service/ class=d-block>Adding a service</a>
<a href=/docs/workflows/verification/ class=d-block>Verifying a deployment</a></div></div><div class=mb-3><h6 class=cursor-pointer data-toggle=collapse data-target=#collapse5>Additional workflows</h6><div class=collapse id=collapse5><a href=/docs/additional-workflows/monitoring/ class=d-block>Monitoring and logging</a>
<a href=/docs/additional-workflows/update-manifest/ class=d-block>Updating a Manifest</a>
<a href=/docs/additional-workflows/updates/ class=d-block>Updating a deployment</a>
<a href=/docs/additional-workflows/recover-coordinator/ class=d-block>Recovering the Coordinator</a></div></div><div class=mb-3><h6 class=cursor-pointer data-toggle=collapse data-target=#collapse6>Building services</h6><div class=collapse id=collapse6><a href=/docs/building-services/ego/ class=d-block>EGo</a>
<a href=/docs/building-services/graphene/ class=d-block>Graphene</a>
<a href=/docs/building-services/occlum/ class=d-block>Occlum</a></div></div><div class=mb-3><h6 class=cursor-pointer data-toggle=collapse data-target=#collapse7>Examples</h6><div class=collapse id=collapse7><a href=/docs/examples/helloworld/ class=d-block>Hello world</a>
<a href=/docs/examples/emojivoto/ class=d-block>Emoji voting</a>
<a href=/docs/examples/graphene/ class=d-block>Graphene-based examples</a>
<a href=/docs/examples/occlum/ class=d-block>Occlum-based examples</a></div></div><div class=mb-3><a href=/docs/changelog/ class=d-block><h6>Changelog</h6></a></div></div></div><div class="col-12 col-lg-9"><article><h1 id=on-premises-marblerun-deployment>On-premises Marblerun deployment</h1><p>This guide walks you through setting up Marblerun for your on-premises deployment.</p><h2 id=prerequisites>Prerequisites</h2><h3 id=hardware-and-firmware>Hardware and firmware</h3><h4 id=cpu>CPU</h4><p>To deploy Marblerun with Intel SGX, the machine or VM has to support Intel SGX.
Particularly, Marblerun requires support for the SGX Datacenter Attestation Primitives (DCAP).
You can verify <a href=https://www.intel.com/content/www/us/en/support/articles/000057420/software/intel-security-products.html>if your CPU supports DCAP</a>.</p><p>For more information read the <a href=https://software.intel.com/content/www/us/en/develop/articles/properly-detecting-intel-software-guard-extensions-in-your-applications.html>Properly Detecting Intel Software Guard Extensions (IntelÂ® SGX) in Your Applications</a> article.</p><h4 id=bios>BIOS</h4><p>BIOS support is required for Intel SGX to provide the capability to enable and configure the Intel SGX feature in the system.
Currently, most of the SGX capable systems have SGX disabled by default in the BIOS. This default setting might change but for now, you need to manually enable it if it&rsquo;s not already enabled.</p><h4 id=updates>Updates</h4><p>As with any modern technology, Intel SGX has been affected by security vulnerabilities. Intel addresses these vulnerabilities by updating the microcode of CPUs, changing the hardware of new CPUs, and updating the system software. Each microcode update that patches an SGX vulnerability requires a BIOS update. During remote attestation, it is checked that the microcode of the CPU which is deployed by the BIOS is up to date. The microcode and platform enclaves are commonly called the platform <code>Trusted Computing Base (TCB)</code>.</p><p>If your BIOS/firmware is outdated, you will see errors as <code>Platform TCB (2) is not up-to-date (oe_result_t=OE_TCB_LEVEL_INVALID)</code> during remote attestation procedures.</p><h4 id=hypervisor>Hypervisor</h4><p>If you are using VMs for your Marblerun deployment, you need to make sure your hypervisor has SGX enabled.
Most of the popular hypervisors support SGX:</p><ul><li><a href=https://software.intel.com/content/www/us/en/develop/articles/virtualizing-intel-software-guard-extensions-with-kvm-and-qemu.html>QEMU/KVM</a></li><li><a href=https://wiki.xenproject.org/wiki/Xen_and_Intel_Hardware-Assisted_Virtualization_Security>XEN</a></li><li>Hyper-V: Hyper-V will only expose SGX to Gen 2 VMs</li><li><a href=https://blogs.vmware.com/vsphere/2020/04/vsphere-7-vsgx-secure-enclaves.html>VMWare vSphere</a></li><li><a href=https://projectacrn.github.io/latest/tutorials/sgx_virtualization.html>ACRN</a></li></ul><h4 id=driver>Driver</h4><p>You need to <a href=https://download.01.org/intel-sgx/latest/dcap-latest/linux/docs/Intel_SGX_DCAP_Linux_SW_Installation_Guide.pdf>install the SGX Driver for systems supporting the Launch Control Configuration</a>.
Azure provides the <a href=https://docs.microsoft.com/en-us/azure/confidential-computing/quick-create-portal#2-install-the-intel-sgx-dcap-driver>instructions on how to install this driver</a> that you can use for your on-premises machines.</p><h3 id=sgx-datacenter-attestation-primitives-dcap>SGX Datacenter Attestation Primitives (DCAP)</h3><p>DCAP is the new attestation mechanism for SGX <a href=(https://software.intel.com/content/www/us/en/develop/blogs/an-update-on-3rd-party-attestation.html)>replacing EPID</a>.
You can find an overview of DCAP in the <a href=https://download.01.org/intel-sgx/dcap-1.1/linux/docs/Intel_SGX_DCAP_ECDSA_Orientation.pdf>official Intel docs</a>.
Marblerun only supports DCAP and requires DCAP libraries installed and configured on your system.</p><p>From the perspective of Marblerun and your workloads DCAP is accessed with a <a href=https://github.com/intel/SGXDataCenterAttestationPrimitives/blob/master/QuoteGeneration/README.md>Quote Generation Library (QGL)</a> and a <a href=https://github.com/intel/SGXDataCenterAttestationPrimitives/blob/master/QuoteVerification/README.md>Quote Verification Library (QVL)</a> for generating and verifying quotes respectively.
The QGL and QVL libraries need to be configured to talk to a <a href=https://download.01.org/intel-sgx/dcap-1.0.1/docs/Intel_SGX_DCAP_ECDSA_Orientation.pdf>Provisioning Certificate Caching Service (PCCS)</a>.
You currently have two options regarding PCCS for your on-premises machines and clusters:</p><ol><li><p>Use a public PCCS service by configuring your QGL and QVL to point to the public endpoints. Currently, only Azure provides such a service that can be used by installing the <a href=https://github.com/microsoft/Azure-DCAP-Client>Azure-DCAP-Client</a> package on your system:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#366>echo</span> <span style=color:#c30>&#39;deb [arch=amd64] https://download.01.org/intel-sgx/sgx_repo/ubuntu bionic main&#39;</span> | sudo tee /etc/apt/sources.list.d/intel-sgx.list
wget -qO - https://download.01.org/intel-sgx/sgx_repo/ubuntu/intel-sgx-deb.key | sudo apt-key add -
<span style=color:#366>echo</span> <span style=color:#c30>&#34;deb [arch=amd64] https://packages.microsoft.com/ubuntu/18.04/prod bionic main&#34;</span> | sudo tee /etc/apt/sources.list.d/msprod.list
wget -qO - https://packages.microsoft.com/keys/microsoft.asc | sudo apt-key add -
sudo apt update <span style=color:#555>&amp;&amp;</span> sudo apt install -y libsgx-dcap-ql libsgx-dcap-ql-dev az-dcap-client
</code></pre></div></li><li><p>Run your own PCCS and expose it to your machine or cluster. See <a href=https://github.com/intel/SGXDataCenterAttestationPrimitives/blob/master/QuoteGeneration/pccs/README.md>Intel&rsquo;s demo reference implementation</a> and <a href=https://download.01.org/intel-sgx/latest/dcap-latest/linux/docs/SGX_DCAP_Caching_Service_Design_Guide.pdf>design guide</a> for more information.</p><p>Follow these steps to setup your machines for your PCCS:</p><ul><li>Install the <a href=https://download.01.org/intel-sgx/latest/dcap-latest/linux/docs/Intel_SGX_DCAP_Linux_SW_Installation_Guide.pdf>DCAP client libraries</a></li><li>Install a <a href=https://github.com/intel/SGXDataCenterAttestationPrimitives/blob/master/QuoteGeneration/qpl/README.md#configuration>configuration that points to your PCCS</a></li></ul><p>The PCCS is a cache, so you need to make sure it stays up to date. In case your cache is outdated, you might see error messages as:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>coordinator-enclave.signed:mbedtls_x509_crt_verify failed with The CRL is expired <span style=color:#555>(</span><span style=color:#033>flags</span><span style=color:#555>=</span>0x20<span style=color:#555>)</span> <span style=color:#555>(</span><span style=color:#033>oe_result_t</span><span style=color:#555>=</span>OE_VERIFY_CRL_EXPIRED<span style=color:#555>)</span>
</code></pre></div><p>You can inspect the Intel Root CA CRL of your PCCS:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl --insecure --request GET --url https://&lt;YOUR_PCCS_DOMAIN&gt;:&lt;YOUR_PCCS_PORT&gt;/sgx/certification/v2/rootcacrl &gt; rootca.crl
openssl crl -inform PEM -text -noout -in rootca.crl
</code></pre></div><p>You can refresh all SGX collaterals for your PCCS:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl --insecure --request GET -H <span style=color:#c30>&#34;admin-token: &lt;my password&gt;&#34;</span> --url https://&lt;YOUR_PCCS_DOMAIN&gt;:&lt;YOUR_PCCS_PORT&gt;/sgx/certification/v2/refresh
</code></pre></div><p>If refreshing CRL fails, you can manually delete the <code>pckcache.db</code> database (default location <code>/opt/intel/sgx-dcap-pccs/pckcache.db</code>) and restart your PCCS.</p></li></ol><div class=note><p><i class="fa fa-info-circle"></i>&nbsp;<strong>Note</strong></p>Currently, the <a href="https://github.com/orgs/edgelesssys/packages?repo_name=marblerun">Marblerun Coordinator</a> and <a href="https://github.com/orgs/edgelesssys/packages?repo_name=ego">EGo</a> docker images are configured to always use the public Azure PCCS.
In the future, we will make this configurable, so you can define your own PCCS for our images.</div><h2 id=deploy-marblerun>Deploy Marblerun</h2><p>You have made sure your hardware supports SGX, updated all firmware, installed the SGX driver, and configured DCAP on all your machines and VMs?
Great! Now it is time to install Marblerun and get going.</p><p>You can either follow our guide and <a href=https://marblerun.sh/docs/deployment/standalone/>use Marblerun in standalone mode</a> .</p><p>Or you follow our instructions to <a href=https://marblerun.sh/docs/deployment/kubernetes/>install Marblerun in your Kubernetes cluster</a>.</p></article></div></div></div><footer class="bg-light text-center p-3"><div>Marblerun is brought to you by <a target=_blank href=https://edgeless.systems/>Edgeless Systems GmbH <img src=/img/ES_Symbol_black.svg class="verticle-align-middle ml-2" alt="Edgeless Systems GmbH Logo" width=14px class=mb-3></a></div></footer><script src=https://code.jquery.com/jquery-3.5.1.slim.min.js integrity=sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js integrity=sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx crossorigin=anonymous></script><script src=/js/main.js></script></body></html>