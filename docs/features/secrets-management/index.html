<!doctype html><html><head><title>Secrets management</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://marblerun.sh/docs/features/secrets-management/><link rel=stylesheet href=https://marblerun.sh/scss/bootstrap.min.f74dc9aab7c9d1e1c529c621ddc19ec6da5e4b53b5a3fd00725652c27aebd224.css emotion=ðŸ¤©><script defer src=https://use.fontawesome.com/releases/v5.10.2/js/all.js></script></head><body><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top container-fluid"><a class=navbar-brand href=/><img src=/img/logo.png width=140px></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/docs/introduction/><i class="fas fa-book"></i>&nbsp;Docs</a></li><li class=nav-item><a class=nav-link href=/community><i class="fas fa-comments"></i>&nbsp;Community</a></li><li class=nav-item><a class=nav-link href=https://github.com/edgelesssys/marblerun><i class="fab fa-github"></i>&nbsp;Github</a></li><li class=nav-item><a href=/docs/getting-started/quickstart class="nav-link btn btn-primary ml-3">Get started â†’</a></li></ul></div></nav><div class="container my-3"><div class=mb-3><div id=breadcrumbs><a href=/>Home</a>
/ <a href=/docs>Docs</a>
/ <a href=/features>Features</a>
/ <a href=/secrets-management>Secrets management</a></div></div><h1 class=my-3>Docs</h1><div class=row><div class="col-12 col-lg-3"><div class=docsSidebar><div class=mb-3><a href=https://marblerun.sh/docs/introduction/ class=d-block>Introduction</a></div><div class=mb-3><h6>Getting Started</h6><a href=https://marblerun.sh/docs/getting-started/quickstart/ class="d-block pl-3">Quickstart</a>
<a href=https://marblerun.sh/docs/getting-started/concepts/ class="d-block pl-3">Concepts</a>
<a href=https://marblerun.sh/docs/getting-started/coordinator/ class="d-block pl-3">Coordinator</a>
<a href=https://marblerun.sh/docs/getting-started/marbles/ class="d-block pl-3">Marbles</a>
<a href=https://marblerun.sh/docs/getting-started/cli/ class="d-block pl-3">CLI</a>
<a href=https://marblerun.sh/docs/getting-started/sgx-device-plugin/ class="d-block pl-3">SGX device plugin</a></div><div class=mb-3><h6>Features</h6><a href=https://marblerun.sh/docs/features/attestation/ class="d-block pl-3">Attestation</a>
<a href=https://marblerun.sh/docs/features/recovery/ class="d-block pl-3">Recovery</a>
<a href=https://marblerun.sh/docs/features/secrets-management/ class="d-block pl-3">Secrets management</a>
<a href=https://marblerun.sh/docs/features/auto-injection/ class="d-block pl-3">Kubernetes integration</a>
<a href=https://marblerun.sh/docs/features/runtimes/ class="d-block pl-3">Supported Runtimes</a>
<a href=https://marblerun.sh/docs/features/planned-features/ class="d-block pl-3">Planned features</a></div><div class=mb-3><h6>Tasks</h6><a href=https://marblerun.sh/docs/tasks/deploy/ class="d-block pl-3">Deploying Marblerun</a>
<a href=https://marblerun.sh/docs/tasks/define-manifest/ class="d-block pl-3">Defining a Manifest</a>
<a href=https://marblerun.sh/docs/tasks/update-manifest/ class="d-block pl-3">Updating a Manifest</a>
<a href=https://marblerun.sh/docs/tasks/add-service/ class="d-block pl-3">Adding a Service</a>
<a href=https://marblerun.sh/docs/tasks/build-service-ego/ class="d-block pl-3">Building a Service: EGo</a>
<a href=https://marblerun.sh/docs/tasks/build-service-graphene/ class="d-block pl-3">Building a Service: Graphene</a>
<a href=https://marblerun.sh/docs/tasks/set-manifest/ class="d-block pl-3">Setting a Manifest</a>
<a href=https://marblerun.sh/docs/tasks/monitoring/ class="d-block pl-3">Monitoring and Logging</a>
<a href=https://marblerun.sh/docs/tasks/verification/ class="d-block pl-3">Verifying a Deployment</a>
<a href=https://marblerun.sh/docs/tasks/updates/ class="d-block pl-3">Updating a Deployment</a>
<a href=https://marblerun.sh/docs/tasks/recover-coordinator/ class="d-block pl-3">Recovering the Coordinator</a></div><div class=mb-3><h6>Examples</h6><a href=https://marblerun.sh/docs/examples/helloworld/ class="d-block pl-3">Hello World</a>
<a href=https://marblerun.sh/docs/examples/emojivoto/ class="d-block pl-3">Confidential Emoji Voting</a>
<a href=https://marblerun.sh/docs/examples/graphene/ class="d-block pl-3">Graphene</a></div><div class=mb-3><a href=https://marblerun.sh/docs/changelog/ class=d-block>Changelog</a></div></div></div><div class="col-12 col-lg-9"><article><h1 id=secrets-management>Secrets management</h1><p>The generation and the management of cryptographic keys and certificates for Marbles (i.e., containers running enclaves) are central duties of the Coordinator. Keys and certificates are passed to Marbles on startup via placeholders defined in the Manifest. You can learn more about this mechanism <a href=https://marblerun.sh/docs/tasks/set-manifest/>here</a>. Specifically, the Coordinator provides the following to Marbles.</p><ul><li><a href=#virtual-sealing-keys>Virtual sealing keys</a></li><li><a href=#shared-symmetric-keys>Shared symmetric keys</a></li><li><a href=#tls-credentials>TLS credentials</a></li></ul><h2 id=virtual-sealing-keys>Virtual sealing keys</h2><p>A key feature of Intel SGX is that it allows enclave software to derive so called &ldquo;sealing keys&rdquo;. Generally, sealing keys are unique for a given enclave software / processor combination. Upon request from an enclave, the processor will deterministically derive the enclave&rsquo;s sealing key using a recipe somewhat reminiscent of the following: <code>hash(cpu_secret, hash(enclave_software), hash(enclave_parameters), ...)</code>. Enclave software uses sealing keys to encrypt data and persist it to local disk. This process is also referred to as &ldquo;sealing&rdquo;. Sealing enables enclave software to persist sensitive data locally between restarts, e.g., after crashes or system reboots.</p><p>Crucially, in SGX, the aforementioned <code>cpu_secret</code> is hard-wired in silicon and is unique per physical processor. Thus, sealing keys do no commute between processors. Particularly in cloud settings, this becomes a problem: if a VM is scheduled on a different host, enclaves running within that VM cannot unseal their local data anymore, because the host&rsquo;s <code>cpu_secret</code> has changed.</p><p>To solve this problem, the Coordinator generates &ldquo;virtual sealing keys&rdquo; for Marbles. After successful validation of a Marble, the Coordinator injects a Marble&rsquo;s virtual sealing key through the <code>{{ hex .Marblerun.SealKey }}</code> placeholder in the <code>Parameters</code> section of the Manifest.</p><p>The Coordinator derives virtual sealing keys from respective Marble&rsquo;s ID and a master secret only known to the Coordinator using the <a href=https://tools.ietf.org/html/rfc5869>HKDF</a> scheme. The ID is a public 128-bit value randomly generated by each Marble for itself upon startup and persisted in plaintext on local storage. Consequently, two Marbles could end up with the same ID and virtual sealing key under certain circumstances. The security implications of this need to be taken into account when using virtual sealing keys. For example, when using virtual sealing keys with AES-GCM, one must only use cryptographically random nonces.</p><h2 id=shared-symmetric-keys>Shared symmetric keys</h2><p>While virtual sealing keys are used by individual Marbles, Marblerun also allows for the sharing of symmetric encryption keys between Marbles via placeholders in the Manifest. The Coordinator creates these keys once and provides them as parameters to corresponding Marbles. Marbles can use shared keys for a variety of tasks, including the bulk encryption of shared data.</p><p>As with virtual sealing keys, care has to be taken to not repeat nonces between Marbles when using shared keys with AES-GCM or similar encryption algorithms.</p><h2 id=tls-credentials>TLS credentials</h2><p>The Coordinator will generate a private TLS key for each new Marble and issue a corresponding X.509 certificate. Both are injected through placeholders in the Manifest. The certificate is signed by the Coordinator&rsquo;s RootCA. Marbles use their TLS credentials to establish secure communication channels with other Marbles and external clients (i.e., user of your app). Clients only need to verify the Coordinator&rsquo;s RootCA once before they can securely communicate with any Marble, as is described in more detail <a href=https://marblerun.sh/docs/tasks/verification/>here</a>.</p><p>Note that a Marble always receives fresh TLS credentials if it is restarted.</p></article></div></div></div><footer class="bg-light text-center p-3"><div>Marblerun is brought to you by <a target=_blank href=https://edgeless.systems/>Edgeless Systems GmbH <img src=/img/ES_Symbol_black.svg class="verticle-align-middle ml-2" alt="Edgeless Systems GmbH Logo" width=14px class=mb-3></a></div></footer><script src=https://code.jquery.com/jquery-3.5.1.slim.min.js integrity=sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js integrity=sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx crossorigin=anonymous></script><script src=/js/main.js></script></body></html>