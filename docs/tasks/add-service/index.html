<!doctype html><html><head><title>Adding a service</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://marblerun.sh/docs/tasks/add-service/><link rel=stylesheet href=https://marblerun.sh/scss/bootstrap.min.05e88624b497548722fef3538d7efdf80b0045261b068a51fbcf9b25d5fa5298.css emotion=ðŸ¤©><script defer src=https://use.fontawesome.com/releases/v5.10.2/js/all.js></script></head><body><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top container-fluid"><a class=navbar-brand href=/><img src=/img/logo.png width=140px></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/docs/introduction/><i class="fas fa-book"></i>&nbsp;Docs</a></li><li class=nav-item><a class=nav-link href=/community><i class="fas fa-comments"></i>&nbsp;Community</a></li><li class=nav-item><a class=nav-link href=https://github.com/edgelesssys/marblerun><i class="fab fa-github"></i>&nbsp;Github</a></li><li class=nav-item><a href=/docs/getting-started/quickstart class="nav-link btn btn-primary ml-3">Get started â†’</a></li></ul></div></nav><div class="container my-3"><div class=mb-3><div id=breadcrumbs><a href=/>Home</a>
/ <a href=/docs>Docs</a>
/ <a href=/tasks>Tasks</a>
/ <a href=/add-service>Add service</a></div></div><h1 class=my-3>Docs</h1><div class=row><div class="col-12 col-lg-3"><div class=docsSidebar><div class=mb-3><a href=https://marblerun.sh/docs/introduction/ class=d-block>Introduction</a></div><div class=mb-3><h6>Getting Started</h6><a href=https://marblerun.sh/docs/getting-started/quickstart/ class="d-block pl-3">Quickstart</a>
<a href=https://marblerun.sh/docs/getting-started/concepts/ class="d-block pl-3">Concepts</a>
<a href=https://marblerun.sh/docs/getting-started/coordinator/ class="d-block pl-3">Coordinator</a>
<a href=https://marblerun.sh/docs/getting-started/marbles/ class="d-block pl-3">Marbles</a></div><div class=mb-3><h6>Features</h6><a href=https://marblerun.sh/docs/features/attestation/ class="d-block pl-3">Attestation</a>
<a href=https://marblerun.sh/docs/features/recovery/ class="d-block pl-3">Recovery</a>
<a href=https://marblerun.sh/docs/features/secrets-management/ class="d-block pl-3">Secrets management</a>
<a href=https://marblerun.sh/docs/features/planned-features/ class="d-block pl-3">Planned features</a></div><div class=mb-3><h6>Tasks</h6><a href=https://marblerun.sh/docs/tasks/deploy/ class="d-block pl-3">Deploying Marblerun</a>
<a href=https://marblerun.sh/docs/tasks/define-manifest/ class="d-block pl-3">Defining a Manifest</a>
<a href=https://marblerun.sh/docs/tasks/set-manifest/ class="d-block pl-3">Setting a Manifest</a>
<a href=https://marblerun.sh/docs/tasks/add-service/ class="d-block pl-3">Adding a service</a>
<a href=https://marblerun.sh/docs/tasks/verification/ class="d-block pl-3">Verifying a deployment</a>
<a href=https://marblerun.sh/docs/tasks/monitoring/ class="d-block pl-3">Monitoring and logging</a>
<a href=https://marblerun.sh/docs/tasks/updates/ class="d-block pl-3">Updating a deployment</a>
<a href=https://marblerun.sh/docs/tasks/recover-coordinator/ class="d-block pl-3">Recovering the Coordinator</a></div><div class=mb-3><h6>Examples</h6><a href=https://marblerun.sh/docs/examples/helloworld/ class="d-block pl-3">Hello World</a>
<a href=https://marblerun.sh/docs/examples/emojivoto/ class="d-block pl-3">Confidential Emoji Voting</a></div><div class=mb-3><a href=https://marblerun.sh/docs/changelog/ class=d-block>Changelog</a></div></div></div><div class="col-12 col-lg-9"><article><h1 id=adding-a-service>Adding a service</h1><p>Adding a service to your application requires two steps:</p><ol><li>Building your service together with Marblerun to inject our Marble data plane.</li><li>Adding the service to the Manifest so it will be recognized and managed by the Coordinator control plane.</li></ol><h2 id=building-your-service-with-marblerun>Building your service with Marblerun</h2><p>We distinguish two cases when building your confidential application with Marblerun:</p><ol><li><p>Your service is written in Go</p><ul><li>You need to build your project together with our Marble code</li><li>We have an example on how to do this <a href=https://github.com/edgelesssys/marblerun/blob/master/samples/helloworld/README.md>here</a></li></ul></li><li><p>Your service is written in any other language that can be compiled to binary code (e.g. C++)</p><ul><li>You need to link your code against our Marble library</li><li>We have an example on how to do this <a href=https://github.com/edgelesssys/marblerun/blob/master/samples/helloc%2B%2B/README.md>here</a></li></ul></li></ol><h2 id=adding-your-service-to-the-manifest>Adding your service to the Manifest</h2><p>The Manifest contains a section with the information used to authenticate each service in the mesh:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>	<span style=color:#e6db74>&#34;Packages&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
		<span style=color:#f92672>&#34;backend&#34;</span>: {
			<span style=color:#f92672>&#34;UniqueID&#34;</span>: <span style=color:#e6db74>&#34;000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f&#34;</span>,
            <span style=color:#f92672>&#34;SignerID&#34;</span>: <span style=color:#e6db74>&#34;c0ffeec0ffeec0ffeec0ffeec0ffeec0ffeec0ffeec0ffeec0ffeec0ffeec0ffee&#34;</span>,
            <span style=color:#f92672>&#34;ProductID&#34;</span>: <span style=color:#ae81ff>1337</span>,
            <span style=color:#f92672>&#34;SecurityVersion&#34;</span>: <span style=color:#ae81ff>1</span>,
			<span style=color:#f92672>&#34;Debug&#34;</span>: <span style=color:#66d9ef>false</span>
		},
    }
</code></pre></div><p>These values correspond directly to values provided in a remote attestation quote from Intel SGX.
Marblerun provides a tool to extract these values from a signed enclave.
You can find this tool in <a href=https://github.com/edgelesssys/marblerun/blob/master/tools/create_config.py>tools/create_config.py</a>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>tools/create_config.py -e enclave.signed
</code></pre></div><p>You&rsquo;ll see something like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#f92672>&#34;SecurityVersion&#34;</span>: <span style=color:#ae81ff>1</span>,
    <span style=color:#f92672>&#34;ProductID&#34;</span>: <span style=color:#ae81ff>3</span>
    <span style=color:#e6db74>&#34;UniqueID&#34;</span>: <span style=color:#e6db74>&#34;6b2822ac2585040d4b9397675d54977a71ef292ab5b3c0a6acceca26074ae585&#34;</span>,
    <span style=color:#f92672>&#34;SignerID&#34;</span>: <span style=color:#e6db74>&#34;5826218dbe96de0d7b3b1ccf70ece51457e71e886a3d4c1f18b27576d22cdc74&#34;</span>
}
</code></pre></div><p>You can add this directly to your <code>manifest.json</code> file like so:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>	<span style=color:#e6db74>&#34;Packages&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
		<span style=color:#f92672>&#34;backend&#34;</span>: {
			<span style=color:#f92672>&#34;UniqueID&#34;</span>: <span style=color:#e6db74>&#34;000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f&#34;</span>,
            <span style=color:#f92672>&#34;SignerID&#34;</span>: <span style=color:#e6db74>&#34;c0ffeec0ffeec0ffeec0ffeec0ffeec0ffeec0ffeec0ffeec0ffeec0ffeec0ffee&#34;</span>,
            <span style=color:#f92672>&#34;ProductID&#34;</span>: <span style=color:#ae81ff>1337</span>,
            <span style=color:#f92672>&#34;SecurityVersion&#34;</span>: <span style=color:#ae81ff>1</span>,
			<span style=color:#f92672>&#34;Debug&#34;</span>: <span style=color:#66d9ef>false</span>
		},
        <span style=color:#f92672>&#34;frontend&#34;</span>: {
            <span style=color:#f92672>&#34;SecurityVersion&#34;</span>: <span style=color:#ae81ff>1</span>,
            <span style=color:#f92672>&#34;ProductID&#34;</span>: <span style=color:#ae81ff>3</span>,
            <span style=color:#f92672>&#34;UniqueID&#34;</span>: <span style=color:#e6db74>&#34;6b2822ac2585040d4b9397675d54977a71ef292ab5b3c0a6acceca26074ae585&#34;</span>,
            <span style=color:#f92672>&#34;SignerID&#34;</span>: <span style=color:#e6db74>&#34;5826218dbe96de0d7b3b1ccf70ece51457e71e886a3d4c1f18b27576d22cdc74&#34;</span>
        }
    }
</code></pre></div><p>When you start your service, you need to pass in a couple of configuration parameters through environment variables.
Make sure that you match the service&rsquo;s name in the Manifest with the <code>EDG_MARBLE_TYPE</code> (Coordinator was started with <code>EDG_COORDINATOR_MESH_ADDR=localhost:2001</code>):</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>EDG_MARBLE_COORDINATOR_ADDR<span style=color:#f92672>=</span>localhost:2001 EDG_MARBLE_TYPE<span style=color:#f92672>=</span>frontend EDG_MARBLE_UUID_FILE<span style=color:#f92672>=</span>$PWD/uuid EDG_MARBLE_DNS_NAMES<span style=color:#f92672>=</span>localhost erthost enclave.signed
</code></pre></div></article></div></div></div><footer class="bg-light text-center p-3"><div>Marblerun is brought to you by <a target=_blank href=https://edgeless.systems/>Edgeless Systems GmbH <img src=/img/ES_Symbol_black.svg class="verticle-align-middle ml-2" alt="Edgeless Systems GmbH Logo" width=14px class=mb-3></a></div></footer><script src=https://code.jquery.com/jquery-3.5.1.slim.min.js integrity=sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js integrity=sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx crossorigin=anonymous></script><script src=/js/main.js></script></body></html>