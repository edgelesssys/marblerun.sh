<!doctype html><html><head><title>SGX device plugin</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://marblerun.sh/docs/getting-started/sgx-device-plugin/><link rel=stylesheet href=https://marblerun.sh/scss/bootstrap.min.f74dc9aab7c9d1e1c529c621ddc19ec6da5e4b53b5a3fd00725652c27aebd224.css emotion=ðŸ¤©><script defer src=https://use.fontawesome.com/releases/v5.10.2/js/all.js></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><meta property="og:title" content="Marblerun - The service mesh for confidential computing"><meta property="og:description" content="Marblerun makes it easy to deploy, scale, and verify your SGX-based apps on vanilla Kubernetes. Think Istio/Consul/Linkerd for confidential computing.â€‹"><meta property="og:image" content="https://www.marblerun.sh/img/social.png"><meta name=twitter:title content="Marblerun - The service mesh for confidential computing"><meta name=twitter:description content="Marblerun makes it easy to deploy, scale, and verify your SGX-based apps on vanilla Kubernetes."><meta name=twitter:image content="https://www.marblerun.sh/img/social.png"><meta name=twitter:card content="Marblerun"></head><body><nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top container-fluid"><a class=navbar-brand href=/><img src=/img/logo.png width=140px></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/docs/introduction/><i class="fas fa-book"></i>&nbsp;Docs</a></li><li class=nav-item><a class=nav-link href=/community><i class="fas fa-comments"></i>&nbsp;Community</a></li><li class=nav-item><a class=nav-link href=https://github.com/edgelesssys/marblerun><i class="fab fa-github"></i>&nbsp;Github</a></li><li class=nav-item><a href=/docs/getting-started/quickstart class="nav-link btn btn-primary ml-3">Get started â†’</a></li></ul></div></nav><div class="container my-3"><div class=mb-3><div id=breadcrumbs><a href=/>Home</a>
/ <a href=/docs>Docs</a>
/ <a href=/getting-started>Getting started</a>
/ <a href=/sgx-device-plugin>Sgx device plugin</a></div></div><h1 class=my-3>Docs</h1><div class=row><div class="col-12 col-lg-3"><div class=docsSidebar><div class=mb-3><a href=https://marblerun.sh/docs/introduction/ class=d-block>Introduction</a></div><div class=mb-3><h6>Getting Started</h6><a href=https://marblerun.sh/docs/getting-started/quickstart/ class="d-block pl-3">Quickstart</a>
<a href=https://marblerun.sh/docs/getting-started/concepts/ class="d-block pl-3">Concepts</a>
<a href=https://marblerun.sh/docs/getting-started/coordinator/ class="d-block pl-3">Coordinator</a>
<a href=https://marblerun.sh/docs/getting-started/marbles/ class="d-block pl-3">Marbles</a>
<a href=https://marblerun.sh/docs/getting-started/cli/ class="d-block pl-3">CLI</a>
<a href=https://marblerun.sh/docs/getting-started/sgx-device-plugin/ class="d-block pl-3">SGX device plugin</a></div><div class=mb-3><h6>Features</h6><a href=https://marblerun.sh/docs/features/attestation/ class="d-block pl-3">Attestation</a>
<a href=https://marblerun.sh/docs/features/recovery/ class="d-block pl-3">Recovery</a>
<a href=https://marblerun.sh/docs/features/secrets-management/ class="d-block pl-3">Secrets management</a>
<a href=https://marblerun.sh/docs/features/auto-injection/ class="d-block pl-3">Kubernetes integration</a>
<a href=https://marblerun.sh/docs/features/runtimes/ class="d-block pl-3">Supported Runtimes</a>
<a href=https://marblerun.sh/docs/features/planned-features/ class="d-block pl-3">Planned features</a></div><div class=mb-3><h6>Tasks</h6><a href=https://marblerun.sh/docs/tasks/deploy/ class="d-block pl-3">Deploying Marblerun</a>
<a href=https://marblerun.sh/docs/tasks/define-manifest/ class="d-block pl-3">Defining a Manifest</a>
<a href=https://marblerun.sh/docs/tasks/update-manifest/ class="d-block pl-3">Updating a Manifest</a>
<a href=https://marblerun.sh/docs/tasks/add-service/ class="d-block pl-3">Adding a Service</a>
<a href=https://marblerun.sh/docs/tasks/build-service-ego/ class="d-block pl-3">Building a Service: EGo</a>
<a href=https://marblerun.sh/docs/tasks/build-service-graphene/ class="d-block pl-3">Building a Service: Graphene</a>
<a href=https://marblerun.sh/docs/tasks/set-manifest/ class="d-block pl-3">Setting a Manifest</a>
<a href=https://marblerun.sh/docs/tasks/monitoring/ class="d-block pl-3">Monitoring and Logging</a>
<a href=https://marblerun.sh/docs/tasks/verification/ class="d-block pl-3">Verifying a Deployment</a>
<a href=https://marblerun.sh/docs/tasks/updates/ class="d-block pl-3">Updating a Deployment</a>
<a href=https://marblerun.sh/docs/tasks/recover-coordinator/ class="d-block pl-3">Recovering the Coordinator</a></div><div class=mb-3><h6>Examples</h6><a href=https://marblerun.sh/docs/examples/helloworld/ class="d-block pl-3">Hello World</a>
<a href=https://marblerun.sh/docs/examples/emojivoto/ class="d-block pl-3">Confidential Emoji Voting</a>
<a href=https://marblerun.sh/docs/examples/graphene/ class="d-block pl-3">Graphene</a></div><div class=mb-3><a href=https://marblerun.sh/docs/changelog/ class=d-block>Changelog</a></div></div></div><div class="col-12 col-lg-9"><article><h1 id=sgx-device-plugin-on-kubernetes>SGX device plugin on Kubernetes</h1><p>Kubernetes manages hardware resources like Intel SGX through its <a href=https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/device-plugins/>device plugin framework</a>.
The SGX device plugin can either be deployed manually or as a DaemonSet in the cluster. Different vendors provide open-source device plugins for SGX:</p><ul><li><a href=https://intel.github.io/intel-device-plugins-for-kubernetes/cmd/sgx_plugin/README.html>Intel</a></li><li><a href=https://github.com/Azure/aks-engine/blob/master/docs/topics/sgx.md#deploying-the-sgx-device-plugin>Azure</a></li><li><a href=https://github.com/AliyunContainerService/sgx-device-plugin>Alibaba Cloud</a></li></ul><p>Marblerun checks if an SGX device plugin is already running and deploys Azure&rsquo;s plugin otherwise. Note that the Azure SGX plugin is not tied to Azure. We may however switch to the official device plugin from Intel in the future.</p><h2 id=manually-deploying-an-sgx-device-plugin>Manually deploying an SGX device plugin</h2><p>For different reasons, you may want to deploy the device plugin manually. This requires two steps. First, add <code>tolerations</code> and <code>resources</code> to your Kubernetes deployment spec as outlined below.</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#309;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>apps/v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#309;font-weight:700>kind</span>:<span style=color:#bbb> </span>Deployment<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#309;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>name</span>:<span style=color:#bbb> </span>oe-deployment<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#309;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>selector</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>matchLabels</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>app</span>:<span style=color:#bbb> </span>oe-app<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>replicas</span>:<span style=color:#bbb> </span><span style=color:#f60>1</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>template</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>labels</span>:<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#309;font-weight:700>app</span>:<span style=color:#bbb> </span>oe-app<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>tolerations</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:#309;font-weight:700>key</span>:<span style=color:#bbb> </span>kubernetes.azure.com/sgx_epc_mem_in_MiB<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#309;font-weight:700>operator</span>:<span style=color:#bbb> </span>Exists<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#309;font-weight:700>effect</span>:<span style=color:#bbb> </span>NoSchedule<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>containers</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:#309;font-weight:700>name</span>:<span style=color:#bbb> </span>&lt;image_name&gt;<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#309;font-weight:700>image</span>:<span style=color:#bbb> </span>&lt;image_reference&gt;<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#309;font-weight:700>command</span>:<span style=color:#bbb> </span>&lt;exec&gt;<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#309;font-weight:700>resources</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:#309;font-weight:700>limits</span>:<span style=color:#bbb>
</span><span style=color:#bbb>            </span><span style=color:#309;font-weight:700>kubernetes.azure.com/sgx_epc_mem_in_MiB</span>:<span style=color:#bbb> </span><span style=color:#f60>10</span><span style=color:#bbb>
</span></code></pre></div><p>Note that in this case, the plugin from Azure is used. Second, install Marblerun using the <code>--no-sgx-device-plugin</code> flag:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>marblerun install <span style=color:#555>[</span>--no-sgx-device-plugin<span style=color:#555>]</span>
</code></pre></div></article></div></div></div><footer class="bg-light text-center p-3"><div>Marblerun is brought to you by <a target=_blank href=https://edgeless.systems/>Edgeless Systems GmbH <img src=/img/ES_Symbol_black.svg class="verticle-align-middle ml-2" alt="Edgeless Systems GmbH Logo" width=14px class=mb-3></a></div></footer><script src=https://code.jquery.com/jquery-3.5.1.slim.min.js integrity=sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js integrity=sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx crossorigin=anonymous></script><script src=/js/main.js></script></body></html>