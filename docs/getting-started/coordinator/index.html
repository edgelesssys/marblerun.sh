<!doctype html><html><head><title>Coordinator</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://marblerun.sh/docs/getting-started/coordinator/><link rel=stylesheet href=https://marblerun.sh/scss/bootstrap.min.e79ca62b6c8afa04887b5b398be1a3f6d8a6a23859b3c8268c66d7e23d3aab8d.css emotion=ðŸ¤©><script defer src=https://use.fontawesome.com/releases/v5.10.2/js/all.js></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><meta property="og:title" content="Marblerun - The service mesh for confidential computing"><meta property="og:description" content="Marblerun makes it easy to deploy, scale, and verify your SGX-based apps on vanilla Kubernetes. Think Istio/Consul/Linkerd for confidential computing.â€‹"><meta property="og:image" content="https://www.marblerun.sh/img/social.png"><meta name=twitter:title content="Marblerun - The service mesh for confidential computing"><meta name=twitter:description content="Marblerun makes it easy to deploy, scale, and verify your SGX-based apps on vanilla Kubernetes."><meta name=twitter:image content="https://www.marblerun.sh/img/social.png"><meta name=twitter:card content="Marblerun"></head><body><nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top container-fluid"><a class=navbar-brand href=/><img src=/img/logo.png width=140px></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/docs/introduction/><i class="fas fa-book"></i>&nbsp;Docs</a></li><li class=nav-item><a class=nav-link href=/community><i class="fas fa-comments"></i>&nbsp;Community</a></li><li class=nav-item><a class=nav-link href=https://github.com/edgelesssys/marblerun><i class="fab fa-github"></i>&nbsp;GitHub</a></li><li class=nav-item><a href=/docs/getting-started/quickstart class="nav-link btn btn-primary ml-3">Get started â†’</a></li></ul></div></nav><div class="container my-3"><div class=mb-3><div id=breadcrumbs><a href=/>Home</a>
/ <a href=/docs>Docs</a>
/ <a href=/getting-started>Getting started</a>
/ <a href=/coordinator>Coordinator</a></div></div><h1 class=my-3>Docs</h1><div class=row><div class="col-12 col-lg-3"><div class=docsSidebar><div class=mb-3><a href=https://marblerun.sh/docs/introduction/ class=d-block>Introduction</a></div><div class=mb-3><h6>Getting Started</h6><a href=https://marblerun.sh/docs/getting-started/quickstart/ class="d-block pl-3">Quickstart</a>
<a href=https://marblerun.sh/docs/getting-started/concepts/ class="d-block pl-3">Concepts</a>
<a href=https://marblerun.sh/docs/getting-started/coordinator/ class="d-block pl-3">Coordinator</a>
<a href=https://marblerun.sh/docs/getting-started/marbles/ class="d-block pl-3">Marbles</a>
<a href=https://marblerun.sh/docs/getting-started/cli/ class="d-block pl-3">CLI</a>
<a href=https://marblerun.sh/docs/getting-started/sgx-device-plugin/ class="d-block pl-3">SGX device plugin</a></div><div class=mb-3><h6>Features</h6><a href=https://marblerun.sh/docs/features/attestation/ class="d-block pl-3">Attestation</a>
<a href=https://marblerun.sh/docs/features/recovery/ class="d-block pl-3">Recovery</a>
<a href=https://marblerun.sh/docs/features/secrets-management/ class="d-block pl-3">Secrets management</a>
<a href=https://marblerun.sh/docs/features/auto-injection/ class="d-block pl-3">Kubernetes integration</a>
<a href=https://marblerun.sh/docs/features/runtimes/ class="d-block pl-3">Supported runtimes</a>
<a href=https://marblerun.sh/docs/features/planned-features/ class="d-block pl-3">Planned features</a></div><div class=mb-3><h6>Tasks</h6><a href=https://marblerun.sh/docs/tasks/deploy/ class="d-block pl-3">Deploying Marblerun</a>
<a href=https://marblerun.sh/docs/tasks/define-manifest/ class="d-block pl-3">Defining a Manifest</a>
<a href=https://marblerun.sh/docs/tasks/update-manifest/ class="d-block pl-3">Updating a Manifest</a>
<a href=https://marblerun.sh/docs/tasks/add-service/ class="d-block pl-3">Adding a service</a>
<a href=https://marblerun.sh/docs/tasks/build-service-ego/ class="d-block pl-3">Building a service: EGo</a>
<a href=https://marblerun.sh/docs/tasks/build-service-graphene/ class="d-block pl-3">Building a service: Graphene</a>
<a href=https://marblerun.sh/docs/tasks/set-manifest/ class="d-block pl-3">Setting a Manifest</a>
<a href=https://marblerun.sh/docs/tasks/monitoring/ class="d-block pl-3">Monitoring and logging</a>
<a href=https://marblerun.sh/docs/tasks/verification/ class="d-block pl-3">Verifying a deployment</a>
<a href=https://marblerun.sh/docs/tasks/updates/ class="d-block pl-3">Updating a deployment</a>
<a href=https://marblerun.sh/docs/tasks/recover-coordinator/ class="d-block pl-3">Recovering the Coordinator</a></div><div class=mb-3><h6>Examples</h6><a href=https://marblerun.sh/docs/examples/helloworld/ class="d-block pl-3">Hello world</a>
<a href=https://marblerun.sh/docs/examples/emojivoto/ class="d-block pl-3">Emoji voting</a>
<a href=https://marblerun.sh/docs/examples/graphene/ class="d-block pl-3">Graphene-based examples</a></div><div class=mb-3><a href=https://marblerun.sh/docs/changelog/ class=d-block>Changelog</a></div></div></div><div class="col-12 col-lg-9"><article><h1 id=coordinator>Coordinator</h1><p>The Coordinator represents the control plane in Marblerun.
It communicates with the data plane through gRPC and provides an HTTP-REST interface on the client-side.
The Coordinator can be configured with several environment variables:</p><ul><li><code>EDG_COORDINATOR_MESH_ADDR</code>: The listener address for the gRPC server</li><li><code>EDG_COORDINATOR_CLIENT_ADDR</code>: The listener address for the HTTP server</li><li><code>EDG_COORDINATOR_DNS_NAMES</code>: The DNS names for the cluster&rsquo;s root certificate</li><li><code>EDG_COORDINATOR_SEAL_DIR</code>: The file path for storing sealed data</li></ul><h2 id=client-api>Client API</h2><p>The Coordinator clients can be devided into two major groups.</p><ul><li>The owners/providers/administrators who need to interact with the coordinator for deploying their confidential application and administrative tasks</li><li>The users/customers who use the coordinator for remote attestation and establishing trust with the application</li></ul><p>The Client API serves both use-cases with a compact REST-API.</p><h3 id=response-style>Response style</h3><p>The Client API is designed as an HTTP-REST interface.Responses follow the <a href=https://github.com/omniti-labs/jsend>JSend</a> style, though only the response types <code>success</code> and <code>error</code> are returned so far.</p><p>In general, a successful API call (HTTP Code 200) will return a response in the following style:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#309;font-weight:700>&#34;status&#34;</span>: <span style=color:#c30>&#34;success&#34;</span>,
    <span style=color:#309;font-weight:700>&#34;data&#34;</span>: {
        <span style=color:#309;font-weight:700>&#34;ManifestSignature&#34;</span>: <span style=color:#c30>&#34;3fff78e99dd9bd801e0a3a22b7f7a24a492302c4d00546d18c7f7ed6e26e95c3&#34;</span>
    }
}
</code></pre></div><p>Depending on the API endpoint and the data submitted, <code>data</code> might contain a specific answer from the coordinator, or may just be <code>null</code> to acknowledge that the requested operation was performed successfully.</p><p>Whereas an error (HTTP Code 4xx or 5xx) might look like this:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#309;font-weight:700>&#34;status&#34;</span>: <span style=color:#c30>&#34;error&#34;</span>,
    <span style=color:#309;font-weight:700>&#34;data&#34;</span>: <span style=color:#069;font-weight:700>null</span>,
    <span style=color:#309;font-weight:700>&#34;message&#34;</span>: <span style=color:#c30>&#34;server is not in expected state&#34;</span>
}
</code></pre></div><p>For errors, <code>data</code> will always be <code>null</code>, and <code>message</code> contains the specific error the Coordinator ran into when processing the request.</p><h3 id=endpoints>Endpoints</h3><p>The API currently contains the following endpoints. If an endpoint specifies <em>Returns</em> for either HTTP GET or HTTP POST, it means that the specified data can be found encoded inside the <code>data</code> block if the response was successful. If no returns are specified for a given endpoint, or in case all possible return values for an endpoint are declared as optional, <code>data</code> can just be <code>null</code>.</p><h4 id=manifest>/manifest</h4><p>For deploying and verifying the Manifest.</p><ul><li>Before deploying the application to the cluster the manifest needs to be set once by the provider</li><li>Users can retrieve and inspect the manifest through this endpoint before interacting with the application</li></ul><p><strong>Returns (HTTP GET)</strong>:</p><table class="table table-striped table-bordered"><thead><tr><th>Field value</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>ManifestSignature</td><td>string</td><td>A SHA-256 of the currently set manifest. Does not change when an Update Manifest has been applied.</td></tr></tbody></table><p><strong>Returns (HTTP POST)</strong>:</p><table class="table table-striped table-bordered"><thead><tr><th>Field value</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>RecoverySecrets</td><td>array (optional)</td><td>An array containing key-value mapping for encrypted secrets to be used for recovering the Coordinator in case of disaster recovery. The key matches each supplied key from <code>RecoveryKeys</code> in the Manifest.</td></tr></tbody></table><p>Example for setting the Manifest (HTTP POST):</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl --cacert marblerun.crt --data-binary @manifest.json <span style=color:#c30>&#34;https://</span><span style=color:#033>$MARBLERUN</span><span style=color:#c30>/manifest&#34;</span>
</code></pre></div><p>Example for verifying the deployed Manifest (HTTP GET):</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl --cacert marblerun.crt <span style=color:#c30>&#34;https://</span><span style=color:#033>$MARBLERUN</span><span style=color:#c30>/manifest&#34;</span> | jq <span style=color:#c30>&#39;.data.ManifestSignature&#39;</span> --raw-output
</code></pre></div><h4 id=quote>/quote</h4><p>For retrieving a remote attestation quote over the whole cluster and the root certificate.
The quote is an SGX-DCAP quote, you can learn more about DCAP in the <a href=https://download.01.org/intel-sgx/sgx-dcap/1.9/linux/docs/Intel_SGX_DCAP_ECDSA_Orientation.pdf>official Intel DCAP orientation</a>.
Both the provider and the users of the confidential application can use this endpoint to verify the integrity of the Coordinator and the cluster at any time.</p><p><strong>Returns (HTTP GET)</strong>:<table class="table table-striped table-bordered"><thead><tr><th>Field value</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>Cert</td><td>string</td><td>A PEM-encoded certificate chain containing the Coordinator&rsquo;s Root CA and Intermediate CA, which can be used for trust establishment between a client and the Coordinator.</td></tr><tr><td>Quote</td><td>string</td><td>Base64-encoded quote which can be used for Remote Attestation, as described in <a href=https://marblerun.sh/docs/tasks/verification/>Verifying a deployment</a></td></tr></tbody></table></p><p>Example for retrieving a quote</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl -k <span style=color:#c30>&#34;https://</span><span style=color:#033>$MARBLERUN</span><span style=color:#c30>/quote&#34;</span>
</code></pre></div><p>We provide a tool to automatically verify the quote and output the trusted certificate:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#09f;font-style:italic># Either install era for the current user</span>
wget -P ~/.local/bin https://github.com/edgelesssys/era/releases/latest/download/era
chmod +x ~/.local/bin/era

<span style=color:#09f;font-style:italic># Or install it globally on your machine (requires root permissions)</span>
sudo wget -O /usr/local/bin/era https://github.com/edgelesssys/era/releases/latest/download/era
sudo chmod +x /usr/local/bin/era

era -c coordinator-era.json -h <span style=color:#033>$MARBLERUN</span> -o marblerun.crt
</code></pre></div><p><em>Note: On machines running Ubuntu, ~/.local/bin is only added to PATH when the directory exists when initializing your bash environment during login. You might need to re-login after creating the directory. Also, non-default shells such as <code>zsh</code> do not add this path by default. Therefore, if you receive <code>command not found: era</code> as an error message for a local user installation, either make sure ~/.local/bin was added to your PATH successfully or simply use the machine-wide installation method.</em></p><p>Note that <code>coordinator-era.json</code> contains the <em>Packages</em> information for the Coordinator. For our testing image this can be pulled from our GitHub releases:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>wget https://github.com/edgelesssys/marblerun/releases/latest/download/coordinator-era.json
</code></pre></div><h4 id=recover>/recover</h4><p>For recovering the Coordinator in case unsealing the existing state failed.</p><p>This API endpoint is only available when the coordinator is in recovery mode. Before you can use the endpoint, you need to decrypt the recovery secret which you may have received when setting the manifest initially. See <a href=https://marblerun.sh/docs/tasks/recover-coordinator/>Recovering the Coordinator</a> to retrieve the recovery key needed to use this API endpoint correctly.</p><p>Example for recovering the coordinator:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl -k -X POST --data-binary @recovery_key_decrypted <span style=color:#c30>&#34;https://</span><span style=color:#033>$MARBLERUN</span><span style=color:#c30>/recover&#34;</span>
</code></pre></div><h4 id=status>/status</h4><p>For returning the current state of the coordinator.</p><p><strong>Returns (HTTP GET)</strong>:<table class="table table-striped table-bordered"><thead><tr><th>Field value</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>StatusCode</td><td>int</td><td>A status code which matches the internal code of the Coordinator&rsquo;s current state.</td></tr><tr><td>StatusMessage</td><td>string</td><td>A descriptive status message of what the Coordinator expects the user to do in its current state.</td></tr></tbody></table></p><p><strong>Possible values</strong>:</p><table class="table table-striped table-bordered"><thead><tr><th>StatusCode</th><th>StatusMessage</th></tr></thead><tbody><tr><td>1</td><td>Coordinator is in recovery mode. Either upload a key to unseal the saved state, or set a new manifest. For more information on how to proceed, consult the documentation.</td></tr><tr><td>2</td><td>Coordinator is ready to accept a manifest.</td></tr><tr><td>3</td><td>Coordinator is running correctly and ready to accept marbles.</td></tr></tbody></table><p>Example for getting the status:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl -k <span style=color:#c30>&#34;https://</span><span style=color:#033>$MARBLERUN</span><span style=color:#c30>/status&#34;</span>
</code></pre></div><p>It may be useful to use this API endpoint and use it for other monitoring tools. More information can be found under <a href=https://marblerun.sh/docs/tasks/monitoring/>Monitoring and Logging</a></p><h4 id=update>/update</h4><p>For updating the packages specified in the currently set Manifest.</p><p>This API endpoint only works when <code>Admins</code> were defined in the Manifest. For more information, look up <a href=https://marblerun.sh/docs/tasks/update-manifest/>Updating a Manifest</a></p><p>Example for updating the manifest:</p><div class=highlight><pre style=background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>curl --cacert marblerun.crt --cert admin_certificate.crt --key admin_private.key -w <span style=color:#c30>&#34;%{http_code}&#34;</span> --data-binary @update_manifest.json https://<span style=color:#033>$MARBLERUN</span>/update
</code></pre></div></article></div></div></div><footer class="bg-light text-center p-3"><div>Marblerun is brought to you by <a target=_blank href=https://edgeless.systems/>Edgeless Systems GmbH <img src=/img/ES_Symbol_black.svg class="verticle-align-middle ml-2" alt="Edgeless Systems GmbH Logo" width=14px class=mb-3></a></div></footer><script src=https://code.jquery.com/jquery-3.5.1.slim.min.js integrity=sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js integrity=sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx crossorigin=anonymous></script><script src=/js/main.js></script></body></html>