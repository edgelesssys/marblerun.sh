---
title: "Managing Secrets"
date: 2021-06-17T13:36:38+02:00
draft: false
weight: 7
---

# Managing Secrets

In some cases a user might need access a secret generated by Marblerun, or they might instead want to set the secret themselves.
While setting this information directly in the Manifest is an option, this would also expose potentially confidential information to everyone with access to the Manifest.

To circumvent this issue, Marblerun allows a user with write permission for specific secrets, to set these after the Manifest has already been set.
Similarily Marblerun also allows users with read permission for specific secrets, to retrieve those secrets from the coordinator.
For this the Coordinator client API exposes the `/secrets` endpoint.


## Reading a secret

Marblerun returns secrets over the client API as JSON strings of their internal structure.
This means that for each secret requested, there will also be some metadata attached.
The important fields are:

* For the types `cert-rsa`, `cert-ecdsa` or `cert-ed25519`:

    * `Cert`: the base64 encoded X.509 Certificate

    * `Private`: the private key matching the certificate in base64 encoding

    * `Public`: the public key matching the certificate in base64 encoding

* For type `symmetric-key`:

    * `Public`/`Private`: the base64 encoded key

    * `Size`: length of the key in bits

* For type `plain`:

    * `Public`/`Private`: the base64 encoded arbitrary data of the secret


## Setting a secret

Setting a secret requires a user to upload a JSON file containing the secret they wish to set to the Coordinator.
Each entry is labeled by the name of the secret and defines either `Key` or `Cert` and `Private`.
The values one needs to set depend on the type of secret:

* For the types `cert-rsa`, `cert-ecdsa` or `cert-ed25519`:

    * `Cert`: a base64 encoded X.509 Certificate

    * `Private`: a base64 encoded private key matching the certificate. This may be omitted.

* For type `symmetric-key`:

    * `Key`: a base64 encoded key, with length matching the size defined in the original manifest

* For the type `plain`:

    * `Key`: arbitrary data in base64 encoding. This may be a key of unspecified length, a confidential config file, or any kind of data only a some Marbles and/or users should have access to.

The following gives an example for a file to set the secrets `user_defined_symmetric_key`, `user_defined_cert`, and `generic_secret`:

```javascript
{
  "user_defined_symmetric_key": {
    "Key": "AAECAwQFBgcICQoLDA0ODw=="
  },
  "user_defined_cert": {
    "Cert": "MIIBjDCCATOgAwIBAgICBTkwCgYIKoZIzj0EAwIwMjEwMC4GA1UEAxMnTWFyYmxlcnVuIENvb3JkaW5hdG9yIC0gSW50ZXJtZWRpYXRlIENBMB4XDTIxMDYxNTA4NTY0M1oXDTIxMDYyMjA4NTY0M1owLTEcMBoGA1UEAxMTTWFyYmxlcnVuIFVuaXQgVGVzdDENMAsGA1UEBRMEMTMzNzAqMAUGAytlcAMhAEPOc066G5XmvLizOKTENSR+U9lv3geZ0/a2+XkhJRvDo20wazAOBgNVHQ8BAf8EBAMCAoQwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwLAYDVR0RBCUwI4IJbG9jYWxob3N0hwR/AAABhxAAAAAAAAAAAAAAAAAAAAABMAoGCCqGSM49BAMCA0cAMEQCIGOlRcynaPaj/flSr2ZEvmTmhuvtmTb4QkwPFtxFz3EJAiB77ijxAcJNxPKcKmgMB+c8NORC+6N/St2iP/oX/vqQvg==",
    "Private": "MC4CAQAwBQYDK2VwBCIEIPlmAOOhAStk8ytxzvekPr8zLaQa9+lxnHK+CizDrMds"
  },
  "generic_secret": {
    "Key": "SGVsbG8gZnJvbSB0aGUgTWFyYmxlcnVuIERvY3MhCg=="
  }
}
```


